<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2022-03-05T11:48:29.549Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>パブリッシャー ドメイン (発行元ドメイン) と発行者確認</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/publisher-domain/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/publisher-domain/</id>
    <published>2022-03-06T15:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.549Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの鶴巻です。<br>今回はしばしばお問い合わせをいただく「パブリッシャー ドメイン (発行元ドメイン)」と「発行者確認」についてまとめます。</p><h2 id="パブリッシャー-ドメイン-発行元ドメイン-とは"><a href="#パブリッシャー-ドメイン-発行元ドメイン-とは" class="headerlink" title="パブリッシャー ドメイン (発行元ドメイン) とは"></a>パブリッシャー ドメイン (発行元ドメイン) とは</h2><p>アプリケーションと Azure AD を連携し、ユーザーが初めてアプリケーションにアクセスすると Azure AD 認証時に以下のような画面が表示される場合があります。<br><img src="/blog/azure-active-directory/publisher-domain/permissions-requested.png"></p><p>ここで表示されている “demo.〇〇〇.com” と表示されている部分がパブリッシャー ドメイン (発行元ドメイン) を表しています。 </p><p>この情報は、ユーザーがサインインしようとしているアプリケーションがどのような組織によって開発されたものであるかを示す情報となります。ユーザーはこの情報を確認することで、信頼された組織が発行したアプリケーションかどうかを判断することが可能となります。</p><p>弊社ドキュメントの <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/publisher-verification-overview">発行者の確認</a> にも詳細が記載されています。お時間あるときにご一読ください。</p><h2 id="パブリッシャー-ドメインの登録に必要なこと"><a href="#パブリッシャー-ドメインの登録に必要なこと" class="headerlink" title="パブリッシャー ドメインの登録に必要なこと"></a>パブリッシャー ドメインの登録に必要なこと</h2><p>パブリッシャー ドメインの登録には大きく分けると以下の二つのステップがあります。</p><ol><li>パブリッシャー ドメインを構成する</li><li>発行者確認を行う</li></ol><p>このうち、”発行者確認” においてよく問題となるケースが生じます。<br>本資料では、これまでにお問い合わせいただいた実績を踏まえ、問題なく構成いただけた報告例をもとに発行者確認に必要な手順や情報を紹介します。</p><h2 id="パブリッシャー-ドメインを構成する"><a href="#パブリッシャー-ドメインを構成する" class="headerlink" title="パブリッシャー ドメインを構成する"></a>パブリッシャー ドメインを構成する</h2><p>パブリッシャー ドメインの構成は発行者確認と比べ比較的容易です。<br>詳細は以下の資料に記載がございますが、抑えていただきたい点を後述します。 </p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/howto-configure-publisher-domain">アプリケーションの発行元ドメインを構成する</a></p><p>パブリッシャー ドメインは、以下のいずれかの方法で構成が可能です。<br>どちらかの方法でドメインの検証ができれば問題ありませんため、アプリケーションを登録する対象テナントの環境に合わせてご選択ください。 </p><ol><li>検証済みのドメインから選択する</li></ol><p>設定対象テナントのカスタム ドメインに、検証済みドメインとしてあらかじめ登録しておくことで、以下のように選択肢に表示されるようになります。<br><img src="/blog/azure-active-directory/publisher-domain/update-domain-1.png"></p><p>カスタム ドメインの追加方法については <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/add-custom-domain">Azure Active Directory ポータルを使用してカスタム ドメイン名を追加する</a> をご参照ください。</p><ol start="2"><li>JSON ファイルを用意する</li></ol><p>[新しいドメインの確認] を選択した際に表示される手順に従って構成します。<br><img src="/blog/azure-active-directory/publisher-domain/update-domain-2.png"></p><p>まず、以下のような内容の JSON ファイルを事前に用意します。<br>{YOUR-APP-ID-HERE} は、パブリッシャー ドメインを構成しているアプリケーションのアプリケーション ID に置き換えます。 </p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;associatedApplications&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;applicationId&quot;</span>: <span class="string">&quot;&#123;YOUR-APP-ID-HERE&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><div class="alert is-info"><p class="alert-title">Note</p><p>パブリッシャー ドメインを構成するアプリケーションが複数ある場合は、{ “applicationId”: “{YOUR-APP-ID-HERE}” } のブロックを必要な数分 “,” で区切って定義します。 </p></div><p>次に、作成した JSON ファイルを、以下のようなパスでアクセスできるよう Web サーバー上に配置します。<br>{YOUR-DOMAIN-HERE} は、[パブリッシャー ドメイン] 欄に入力したドメインに置き換えます。 </p><blockquote><p>https://{YOUR-DOMAIN-HERE}.com/.well-known/microsoft-identity-association.json</p></blockquote><h2 id="発行者確認を行う"><a href="#発行者確認を行う" class="headerlink" title="発行者確認を行う"></a>発行者確認を行う</h2><p>発行者確認を行うには、[MPN ID を追加して発行元を確認します] をクリックして表示される画面にも表示されているとおり、事前に満たしておくべき条件がいくつかあります。<br><img src="/blog/azure-active-directory/publisher-domain/publisher-verified.png"></p><ol><li><p>大前提となる条件は <a href="https://docs.microsoft.com/ja-jp/partner-center/mpn-create-a-partner-center-account">Microsoft Partner Network プログラム</a> に登録し、審査が完了していることです </p></li><li><p>パートナー グローバル アドレス (PGA) の連絡先メール アドレスのドメインが、アプリケーションを登録するテナントに、検証済みカスタム ドメインとして登録されている必要があります<br><img src="/blog/azure-active-directory/publisher-domain/custom-domain.png"></p></li></ol><div class="alert is-info"><p class="alert-title">Note</p><p>たとえば、<a href="mailto:&#x61;&#x64;&#109;&#x69;&#x6e;&#64;&#99;&#111;&#110;&#116;&#111;&#115;&#111;&#46;&#x63;&#111;&#109;">&#x61;&#x64;&#109;&#x69;&#x6e;&#64;&#99;&#111;&#110;&#116;&#111;&#115;&#111;&#46;&#x63;&#111;&#109;</a> というメール アドレスが PGA の連絡先メール アドレスである場合、”contoso.com” ドメインが、アプリケーションを登録するテナントの検証済みカスタム ドメインに登録されている必要があります</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>検証済みカスタム ドメインはサブドメインも許容されます。</p><p>たとえば、<a href="mailto:&#x61;&#x64;&#x6d;&#105;&#110;&#x40;&#115;&#x75;&#98;&#46;&#x63;&#111;&#x6e;&#116;&#x6f;&#115;&#111;&#46;&#x63;&#111;&#x6d;">&#x61;&#x64;&#x6d;&#105;&#110;&#x40;&#115;&#x75;&#98;&#46;&#x63;&#111;&#x6e;&#116;&#x6f;&#115;&#111;&#46;&#x63;&#111;&#x6d;</a> というメール アドレスが PGA の連絡先メール アドレスである場合、”contoso.com” ドメインが、アプリケーションを登録するテナントの検証済みカスタム ドメインに登録されていれば問題ありません。”sub.contoso.com” を検証済みカスタム ドメインとして構成いただく必要はありません。</p></div><ol start="3"><li>アプリケーションが登録されている対象テナントが Microsoft Partner Network テナント管理の一覧に含まれている必要があります</li></ol><p>発行者確認を行う前に、上記を満たしているかどうか事前にご確認をお願いします。<br>実際に発行者確認を行う場合には、さらに以下の条件をすべて満たす必要があります。</p><ol><li><p>検証を実施するアカウントが Azure ポータルへ多要素認証を利用してサインインしている必要があります</p></li><li><p>検証を実施するアカウントに以下の権限が割り当てられている必要があります</p><ol><li><p>Azure AD で、アプリケーション管理者、クラウド アプリケーション管理者、グローバル管理者のいずれかの Azure AD ロールが割り当てられていること </p></li><li><p>パートナー センターで、MPN 管理者、アカウント管理者のいずれかのロールが割り当てられていること (Azure AD でグローバル管理者が割り当て手られている場合は不要) </p></li></ol></li></ol><p>上記の内容の詳細は <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/mark-app-as-publisher-verified">アプリを発行者確認済みとしてマークする</a> に記載があります。こちらもご一読ください。</p><h2 id="よくある質問"><a href="#よくある質問" class="headerlink" title="よくある質問"></a>よくある質問</h2><p>以下の点と併せて <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/troubleshoot-publisher-verification">発行者の確認に関するトラブルシューティング</a> もご覧ください。 </p><h3 id="ゲスト-ユーザーで作業を実施できますか"><a href="#ゲスト-ユーザーで作業を実施できますか" class="headerlink" title="ゲスト ユーザーで作業を実施できますか"></a>ゲスト ユーザーで作業を実施できますか</h3><p>これまでにゲスト ユーザーで実施できた実績がありません。<br>上記にて「アプリケーションが登録されている対象テナントが Microsoft Partner Network テナント管理の一覧に含まれている必要があります」と説明していますが、サインインに使用しているユーザー アカウントのテナントも同様に含まれている必要があります。<br>ゲスト ユーザーのテナントが管理外のテナントである場合やマイクロソフト アカウントである場合、一覧に追加することができないことが想定されますため、アプリケーションを登録する組織内のユーザーで実施いただくことをおすすめいたします。 </p><p>いかがでしたでしょうか。<br>もしうまく登録／構成ができない場合には、上記の確認ポイントをすべてクリアできているかどうかご確認いただければうれしいです。</p><p>では、また今度！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの鶴巻です。&lt;br&gt;今回はしばしばお問い合わせをいただく「パブリッシャー ドメイン (発行元ドメイン)」と「発行者確認」についてまとめます。&lt;/p&gt;
&lt;h2 id=&quot;パブリッシャー-ドメイン-発行元ドメイ</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Application" scheme="https://jpazureid.github.io/blog/tags/Application/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD の変更管理を簡素化します</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-change-management-simplified/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-change-management-simplified/</id>
    <published>2022-03-03T21:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.213Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2022 年 3 月 1 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/azure-ad-change-management-simplified/ba-p/2967456">Azure AD: Change Management Simplified</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>クラウド サービスでは、現実として急激な変化が日々生じています。Azure AD だけでも、新機能のリリース、既存機能の変更、廃止やサポート終了など、毎年数百の変更が行われています。これらの変更を管理することがますます難しくなっているというお客様の声を受け、本日より Azure AD の変更管理を簡素化することにしました。</p><p>年間を通じて新しい機能を提供し続ける一方で、機能の廃止や製品のサポート終了については、1 年に 2 回 (毎年 3 月と 9 月) に発表することとし、サポート終了までのタイムラインも一貫したものにします (一部の例外を除く)。この新しいモデルにより、お客様は製品や機能の変更を予測することができ、より新しく、より安全な技術を速やかに採用することができるようになります。</p><p>2022 年 3 月の発表に含まれる非推奨の情報一覧は以下のとおりです。</p><ul><li>2022 年 6 月 30 日に予定されていた Azure AD Graph API の <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">リタイア</a> は <strong>延期</strong> となりました。Azure AD Graph API のように特に重要な依存関係のあるコンポーネントから移行するのは容易ではないというお客様のフィードバックに耳を傾け、少なくとも今年末まではリタイアの時期を遅らせることにしました。移行を支援する追加のツールの情報を含め、今年半ばにリタイアに関する最新情報を提供する予定です。詳細については、<a href="https://docs.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-overview">Azure AD Graph アプリを Microsoft Graph に移行する - Microsoft Graph | Microsoft Docs</a> を参照ください。</li><li>Azure AD Graph および MSOnline PowerShell の <a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">ライセンス割り当て API</a> と PowerShell コマンドレットについては引き続き 2022 年 8 月 26 日にリタイアする予定です。Microsoft Graph からライセンス管理 API にアクセスするようアプリを移行ください。詳しくは、<a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">Microsoft Graph からライセンス管理 API にアクセスするようアプリを移行する</a> をご覧ください。</li><li>Azure AD の管理に Azure AD PowerShell や MSOnline PowerShell モジュールを使っている方は、ぜひ Microsoft Graph PowerShell SDK をお試しくださいとちうことを <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/automate-and-manage-azure-ad-tasks-at-scale-with-the-microsoft/ba-p/1942489">以前にお伝え</a> しました。Microsoft では現在および今後の PowerShell への投資をすべて Microsoft Graph PowerShell SDK に対して行っており、これは今後も変わりはありません。6 月 30 日に Azure AD Graph API を廃止しないという発表を受け、今後の弊社の目標は Azure AD Graph API と MSOnline モジュールに依存する既存のスクリプトならびに PowerShell プロセスを Microsoft Graph PowerShell SDK に移行するため、そのガイダンスとツールを提供することとなります。これは、 2022 年 12 月以降に <strong>2 つの PowerShell モジュール (MSOL &amp; AAD) が非推奨となる予定</strong> であるためです。詳しくは <a href="https://docs.microsoft.com/en-us/powershell/microsoftgraph/migration-steps?view=graph-powershell-beta">こちら</a> と <a href="https://docs.microsoft.com/en-us/graph/migrate-azure-ad-graph-faq">こちら</a> をご確認ください。</li><li>ADAL のサポート終了は、6 月 30 日から 2022 年 12 月に延長されます。 ADAL のアプリは引き続き動作しますが、サポートやセキュリティ修正サポート終了後は提供されません。 また、ADAL への機能追加や新しいプラットフォームへの対応などのリリースは予定されていません。詳しくは、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">Update your applications to use Microsoft Authentication Library and Microsoft Graph API</a> を参照ください。</li><li>パブリック クラウドのレガシーな TLS 1.0 および 1.1 プロトコルの廃止を開始し、今年中に段階的に廃止を進めていく予定です。詳しくは、<a href="https://docs.microsoft.com/ja-jp/troubleshoot/azure/active-directory/enable-support-tls-environment?tabs=azure-monitor">Azure AD TLS 1.0/1.1 は非推奨になるため TLS 1.2 サポートを有効にする - Active Directory | Microsoft Docs</a> を参照ください。</li><li>Azure AD Connect Sync の過去のバージョンは、それより新しいバージョンが出た日から 12 ヶ月後に非推奨となります。[Azure AD Connect Sync サーバーをアップグレードするには、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-upgrade-previous-version">Azure AD Connect: 旧バージョンから最新バージョンにアップグレードする</a> をご覧ください。  </li><li>2020 年 8 月以前に作成された有効なテナントについて、MFA と SSPR の統合されたセキュリティ情報登録ページを有効にする予定です。このユーザー体験の詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-registration-mfa-sspr-combined">Azure Active Directory での統合されたセキュリティ情報の登録の概要</a> をご覧ください。</li><li>Azure Key Vault チームは、お客様のシークレット、キー、および証明書が誤って削除されないよう保護するために、すべてのキー コンテナーにソフト デリートの保護を適用することに取り組んでいます。ソフト デリートは、削除されたキー コンテナーに加え、キー コンテナー内に保存されたシークレットを最大 90 日間復元可能にする機能で、お客様は削除されたシークレットをご自身で復元することが可能です。既存のすべてのキー コンテナーのリソースに対し、2025 年 2 月 1 日までにソフト デリートが自動的に有効になります。ソフト デリートは有効化のみが可能です。つまり一度有効にすると、この機能を無効にすることはできません。詳しくは <a href="https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-change">すべてのキー コンテナーでの論理的な削除の有効化</a> をご覧ください。</li></ul><p><strong>2022 年の変更に関するお知らせのタイムライン:</strong></p><p><img src="/blog/azure-active-directory/azure-ad-change-management-simplified/change-comms-timeline.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 3 月 1 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD B2B の多要素認証について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/b2b-mfa/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/b2b-mfa/</id>
    <published>2022-02-28T01:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.249Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure Identity サポート チームです。<br>こちらのブログでは、 Azure AD B2B (Business-To-Business) コラボレーション機能 (以下、Azure AD B2B) の多要素認証について、下記 3 つのポイントを中心にご紹介いたします。</p><ol><li>ゲスト ユーザーにおける認証方法の登録先テナントについて</li><li>ゲスト ユーザーによる登録済み認証方法の変更手順について</li><li>Azure B2B での例外的な多要素認証の動作について</li></ol><h2 id="Azure-AD-B2B-とは？"><a href="#Azure-AD-B2B-とは？" class="headerlink" title="Azure AD B2B とは？"></a>Azure AD B2B とは？</h2><p>Azure AD B2B とは、外部の組織に属するユーザーのアカウントを貴社のテナントにゲスト ユーザーとして招待することで、貴社のアクセス制御のセキュリティを維持した状態でアプリまたサービスをゲスト ユーザーと安全に共有できる機能となります。</p><p>これによりゲスト ユーザーは、各自の職場または学校のアカウント、またソーシャル アカウントなどを使用して、招待されたテナントが提供するアプリとサービスにサインインすることが可能となり、組織の外部ユーザーのアカウント管理のオーバーヘッドが削減されます。<br>なお、 B2B についてのご説明は以下のブログにもおまとめしておりますので、機能のご紹介は以下を参照ください。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/what-is-b2b/">https://jpazureid.github.io/blog/azure-active-directory/what-is-b2b/</a></p><p>本ブログでは ユーザーのアカウントがメンバーとして所属している Azure AD を “ホーム テナント”、<br>そのユーザーがゲストとして招待された先の Azure AD を “リソース テナント” と記載します。<br>(* ゲスト ユーザーが利用するサービス、例えば SharePoint Online などのリソースが存在するテナントという意味でこのような表記としています。)</p><h2 id="1-ゲスト-ユーザーにおける認証方法の登録先テナントについて"><a href="#1-ゲスト-ユーザーにおける認証方法の登録先テナントについて" class="headerlink" title="1. ゲスト ユーザーにおける認証方法の登録先テナントについて"></a>1. ゲスト ユーザーにおける認証方法の登録先テナントについて</h2><p>テナント内のユーザーに対して条件付きアクセスなどを利用して多要素認証を要求した場合は、そのテナントに登録された多要素認証の方法が利用されていました。ゲストユーザーに対して条件付きアクセスで多要素認証を要求した時の動作はどうなるのでしょうか。</p><p>ゲスト ユーザーに対する多要素認証の要求については、基本的にユーザーがメンバーとして所属しているホーム テナントまた ID プロバイダー側ではなく、アクセス先のリソース テナントのポリシーに準拠します。<br>つまり、ゲスト ユーザーがリソーステナントのアプリまたサービスへアクセスした場合、ホーム テナントまた ID プロバイダー側で資格情報の確認が実施された後、リソース テナントに定義されている条件付きアクセスのポリシーなどにより多要素認証が要求されます。</p><p>以下に、ゲスト ユーザーとして招待されたテナントにおける多要素認証のフローをご紹介します。</p><p> <img src="/blog/azure-active-directory/b2b-mfa/1.png"></p><ol><li>会社 A のテナントに属するアカウントから、外部ユーザーをゲスト ユーザーとしてテナントに招待します。</li><li>ゲスト ユーザーは、自身のアカウントにてホーム テナントまたは ID プロバイダー側で資格情報を使用してサインインします。</li><li>ゲスト ユーザーは、会社 A のアクセス制御のポリシーにより多要素認証を求められます。</li><li>ゲスト ユーザーは、会社 A で電話また認証アプリなどの認証情報の登録が要求され※3、多要素認証を完了することでアクセスが許可されます。</li></ol><p>※3 ゲスト ユーザーはアクセス先のリソーステナント毎に認証情報の登録が必要です。</p><p>公開情報: チュートリアル: B2B ゲスト ユーザーに多要素認証を適用する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/b2b-tutorial-require-mfa">https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/b2b-tutorial-require-mfa</a></p><h2 id="2-ゲスト-ユーザーによる登録済み認証方法の変更手順について"><a href="#2-ゲスト-ユーザーによる登録済み認証方法の変更手順について" class="headerlink" title="2. ゲスト ユーザーによる登録済み認証方法の変更手順について"></a>2. ゲスト ユーザーによる登録済み認証方法の変更手順について</h2><p>上述の通り、ゲスト ユーザーは多要素認証の認証情報についてテナント毎に登録が必要となります。各テナントの認証情報については、以下の手順に沿ってゲスト ユーザー自身にてセキュリティ情報ページから認証情報の追加・変更をすることができます。</p><p>(1) マイアカウント ( <a href="https://myaccount.microsoft.com/">https://myaccount.microsoft.com/</a>) にアクセスし、ゲスト ユーザーのアカウントにてサインインを実施します。</p><p>(2) 画面右上にある組織のアイコン (下図赤丸) をクリックし、所属しているテナントの一覧から、ゲスト ユーザーとして招待されているテナントをクリックしてサインインしてください。<br> ※下図の例では、ユーザーがメンバーとして所属するテナントが「MyTenant」、ゲスト ユーザーとして招待されているテナントが「Contoso」となります。<br> <img src="/blog/azure-active-directory/b2b-mfa/2.png"></p><p>(3) 画面左側の [組織] をクリックし、ユーザーがゲストとして招待されているテナントにサインイン済みであることを確認します。<br>※サインイン状態のテナントには [サインイン済み] が表示されます。下図の例では「Contoso」にサインインしている状態です。<br> <img src="/blog/azure-active-directory/b2b-mfa/3.png"></p><p>(4) 画面左側の [セキュリティ情報] をクリックすると、ゲスト ユーザーとして招待されたテナントで登録された認証情報が確認できます。<br>必要に応じて認証方法の追加 / 変更 / 削除 をクリックして設定内容を管理することが可能です。<br>※すでに認証情報が登録されている場合は多要素認証が要求されます。<br>  <img src="/blog/azure-active-directory/b2b-mfa/4.png"></p><h2 id="3-Azure-B2B-での例外的な多要素認証の動作について"><a href="#3-Azure-B2B-での例外的な多要素認証の動作について" class="headerlink" title="3. Azure B2B での例外的な多要素認証の動作について"></a>3. Azure B2B での例外的な多要素認証の動作について</h2><p>Microsoft アカウント には、Azure AD テナントとは別に Microsoft アカウント専用の 2 段階認証 (メール等) ※4 が存在します。<br>Microsoft アカウントをゲスト ユーザーとして Azure AD テナントへ招待した場合のみ、多要素認証の実装方法 (セキュリティの既定値群、または条件付きアクセス) に依存して、Azure AD テナント側の認証方法ではなく、 Microsoft アカウント 専用の 2 段階認証 (メール等) が利用される場合があります。</p><p>・リソーステナントの多要素認証が条件付きアクセスのポリシーにて実装されている場合<br>Azure AD アカウントのゲスト ユーザーと同様、Azure AD テナントのゲスト ユーザー (emailaddress#EXT#@domain 形式の UPN) としてリソーステナントに登録されている認証方法 (電話、認証アプリなど) が利用されます。</p><p>・リソーステナントでセキュリティの既定値群を有効とされている場合<br>Microsoft アカウント 側の 2 段階認証 (メール等) の認証方法が利用されます。</p><p>もしリソーステナントのゲスト ユーザーが利用できる認証方法を統一したいなどのご要望がある場合は、条件付きアクセスのポリシーにより多要素認証が求められるように構成することをお勧めいたします。</p><p>※4 Microsoft アカウント側でも 2 段階認証を登録する必要があります。<br><a href="https://support.microsoft.com/ja-jp/account-billing/microsoft---c7910146-672f-01e9-50a0-93b4585e7eb4">https://support.microsoft.com/ja-jp/account-billing/microsoft---c7910146-672f-01e9-50a0-93b4585e7eb4</a></p><p>以上の情報がご参考になれば幸いです。<br>ご不明な点がございましたら弊社サポートまでお気軽にお寄せください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure Identity サポート チームです。&lt;br&gt;こちらのブログでは、 Azure AD B2B (Business-To-Business) コラボレーション機能 (以下、Azure AD B2B) の多要素認証について、下記 3 つのポイントを中</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="MFA" scheme="https://jpazureid.github.io/blog/tags/MFA/"/>
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>CloudKnox Permissions Management がパブリック プレビューに</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/</id>
    <published>2022-02-26T18:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.269Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの高田です。</p><p>本記事は、 2022 年 2 月 23 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/cloudknox-permissions-management-is-now-in-public-preview/ba-p/2464391">CloudKnox Permissions Management is now in Public Preview</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>昨年 7 月、Microsoft は <a href="https://docs.microsoft.com/azure/active-directory/cloud-infrastructure-entitlement-management">Cloud Infrastructure Entitlement Management (CIEM)</a> 分野のリーダーである CloudKnox Security の <a href="https://blogs.microsoft.com/blog/2021/07/21/microsoft-acquires-cloudknox-security-to-offer-unified-privileged-access-and-cloud-entitlement-management/">買収を発表</a> しました。当社が思い描くマルチクラウドのセキュリティの重要な取り組みとして、CloudKnox を当社のテクノロジーに統合するべく取り組んでまいりました。本日、<a href="https://microsoft.com/security/business/identity-access-management/permissions-management">CloudKnox Permissions Management</a> のパブリック プレビューを発表することができ、大変うれしく思います。</p><p>皆様もご存じのとおり、クラウドでは ID とアクセス許可の数が爆発的に増加しており、新たなセキュリティ上の課題が生まれています。社内 IT チームは、ID とそのアクセス許可を可視化することが大変難しい状況にあり、さらに増え続けるアクセス許可と利用実態の乖離に格闘している状況です。これらの課題には、完全な可視化とリスクの是正を実現する包括的な統合ソリューションが必要です。</p><p>以下では、重要なクラウド リソースを保護するために、CloudKnox Permissions Management がアクセス許可のリスクを継続的に監視して是正する方法の概要をまとめました。CloudKnox Permissions Management の詳細については、<a href="https://docs.microsoft.com/en-us/azure/active-directory/cloud-infrastructure-entitlement-management/">当社のドキュメントをご覧</a> ください。</p><h2 id="アクセス許可に関わるリスクを包括的に把握する"><a href="#アクセス許可に関わるリスクを包括的に把握する" class="headerlink" title="アクセス許可に関わるリスクを包括的に把握する"></a>アクセス許可に関わるリスクを包括的に把握する</h2><p>CloudKnox Permissions Management は、クラウド基盤全体のすべての ID とそれらに付与されたアクセス許可および実際に使用されたアクセス許可の内容を詳細に可視化することができ、これによりどの ID が何のリソースに対してどのような操作を実行したかを確認することが可能となります。これには、ユーザー ID に限らず、仮想マシン、アクセス キー、コンテナ、スクリプトなどのワークロード ID も含まれており、Amazon Web Services (AWS)、Google Cloud Platform (GCP)、Microsoft Azure の 3 つの主要クラウド プロバイダーで確認可能です。ダッシュボードでは、組織のアクセス許可状況の概要を確認し、基盤全体で最もリスクの高い ID とリソースがどこにあるのかを特定できます。これには、与えられたアクセス許可と使用されたアクセス許可との間の乖離を計算する 0 から 100 までの単一の指数である <strong>Permission Creep Index</strong> が活用いただけます。未使用のアクションや手つかずのリソースが多いほど、その乖離と指数は高くなります。</p><p>これにより、Permission Creep Index が高い特定の ID を簡単に特定し、付与されたアクセス許可と実際に使用されたアクセス許可、およびアクセス可能なリソースを確認することができます。最も高いリスクがどこにあるかを特定し、そのリスクを解消するためには、このレベルの可視化機能が必要です。</p><p><img src="/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/ck-gif-1.gif"></p><h2 id="最小特権アクセスを自動的に実現する"><a href="#最小特権アクセスを自動的に実現する" class="headerlink" title="最小特権アクセスを自動的に実現する"></a>最小特権アクセスを自動的に実現する</h2><p>基盤全体の最も重要なアクセス許可のリスクが特定できたら、CloudKnox Permissions Management により過剰なアクセス許可を適正化し、<strong>自動的に最小特権のポリシーを強制</strong> することが可能です。このソリューションは、各 ID の過去のアクセス許可の利用状況データを継続的に分析しており、その ID のアクセス許可を日々の運用に使用されている権限にのみに適正化することができます。また、未使用でリスクの高いアクセス許可はすべて削除することもできます。</p><p>ID が特定のリソースに対して特定のアクションを実行する必要がある場合、その ID はセルフサービス ワークフローを使用して、期間限定でこれらの <strong>アクセス許可を適宜要求</strong> することができます。ビルトインのワークフロー エンジンに加えて、お気に入りの ITSM ツールを使用することも可能です。ID の種類 (人に紐づくものならびに人に紐づかないもの)、ID のソース (ローカル、エンタープライズ ディレクトリ、フェデレーション)、クラウドに関係なく、同じように操作が可能です。</p><p><img src="/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/ck-gif-2.gif"></p><h2 id="異常検知を効率化してインシデント対応を加速させる"><a href="#異常検知を効率化してインシデント対応を加速させる" class="headerlink" title="異常検知を効率化してインシデント対応を加速させる"></a>異常検知を効率化してインシデント対応を加速させる</h2><p>アクセス許可の悪用や発生しうるデータ漏洩を防ぐため、<strong>機械学習を活用した異常値と特異動作の検出アラート</strong> により、疑わしい動きがあった場合に管理者に通知が可能です。また、特定のアクションやリソース、または任意の組み合わせに対してカスタム アラート トリガーを設定し、監視を自動化してインシデント レスポンスを実行することも可能です。</p><p>基盤を監視して迅速な改善をサポートするもう一つの方法として、カスタム フォレンジック レポートを生成するもできます。例えば、Permissions Analytics Report では、クラウド環境全体の主要なアクセス許可リスクの概要を確認可能です。これらのレポートは、特定のクラウド アカウントを対象にカスタマイズすることができ、事前に設定した間隔で電子メールで配信することもできます。</p><p><img src="/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/ck-gif-3.gif"></p><p>CloudKnox Permissions Management を是非お試しください。ご質問やパブリック プレビューにご興味のある方は、<a href="https://aka.ms/CloudKnoxPublicPreview">こちらのフォームにご記入</a> ください。また、2 月 24 日に開催されるイベント <a href="https://mssecurityinnovationevent.eventcore.com/?ocid=AID3043366_QSG_563806https://mssecurityinnovationevent.eventcore.com/?ocid=AID3043366_QSG_563806">What’s Next in Security</a> にて、Balaji Parimi と Joseph Dadzie がお客様を交えて講演を行いますので、こちらもお見逃しなく。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/Alex_A_Simons">@Alex_A_Simons</a>)<br>Corporate Vice President<br>Microsoft Identity and Network Access Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの高田です。&lt;/p&gt;
&lt;p&gt;本記事は、 2022 年 2 月 23 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>よくわかるパスワード ポリシーとよくある質問</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/comprehend-password-policy/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/comprehend-password-policy/</id>
    <published>2022-02-25T16:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.293Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。</p><p>今日は、混乱しやすい Azure AD のパスワード ポリシーについて、どのユーザーにどの項目が該当するか、同期ユーザーとクラウド ユーザーの観点からそれぞれご案内します。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>多くの企業では、Azure AD Connect を使用し、オンプレミス側からユーザー アカウントを同期して Azure AD や Microsoft 365 を利用していることと思います。Azure AD には、クラウド上に直接作成したクラウド ユーザーや、ほかのテナントから招待したゲスト ユーザーなど、多くの種類のアカウントも登録されている場合もあります。</p><p>最近では、MFA などパスワード以外の方法も併用してサインインする方法も増えてきましたが、パスワードを使用して Azure AD やオンプレミス環境にサインインしている方がほとんどと思います。こうしたパスワードを利用する様々なユーザー アカウントを管理するうえで、Azure AD や Microsoft 365 の管理者は、どのユーザーにどういったパスワード ポリシーが割り当たっているか確認する必要がありますが、ユーザーの種類や環境の多さにより、どの設定が適用されているのかわかりにくい場面が多くあります。</p><p>こうしたパスワード ポリシーについて、「公開情報を確認しても混乱している、認識を確認したい」といったお問い合わせを多く頂戴していることから、今回は各設定の詳細についてご案内します。</p><p>最後の FAQ ではマイクロソフトが推奨するパスワード ポリシーについても記載してありますので併せてご覧ください。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><p>A. ユーザー種類別のパスワード ポリシー早見表<br>B. パスワード変更およびリセット時に評価されるポリシー (文字数と複雑性)<br>C. 認証時に評価されるポリシー (有効期限)</p><ul><li>C-1. パスワード ハッシュ同期環境の同期ユーザー    </li><li>C-2. パススルー認証や AD FS 環境などオンプレミス側で認証を行う同期ユーザー    </li><li>C-3. クラウド ユーザー    </li><li>C-4. ゲスト ユーザー</li></ul><p>D. 補足情報 (FAQ)</p><h2 id="A-ユーザー種類別のパスワード-ポリシー早見表"><a href="#A-ユーザー種類別のパスワード-ポリシー早見表" class="headerlink" title="A. ユーザー種類別のパスワード ポリシー早見表"></a>A. ユーザー種類別のパスワード ポリシー早見表</h2><p>パスワード ポリシーの詳細に入る前に、まずはパスワード ポリシー早見表をユーザー種類別に案内します。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy1b.png"></p><h2 id="B-パスワード変更およびリセット時に評価されるポリシー-文字数と複雑性"><a href="#B-パスワード変更およびリセット時に評価されるポリシー-文字数と複雑性" class="headerlink" title="B. パスワード変更およびリセット時に評価されるポリシー (文字数と複雑性)"></a>B. パスワード変更およびリセット時に評価されるポリシー (文字数と複雑性)</h2><p>パスワードの文字数や複雑性は、同期ユーザーかクラウド ユーザーかの観点で判断することができます。同期ユーザーの文字数や複雑性のポリシーには、オンプレミス AD 側のパスワード ポリシーが適用されます。</p><h3 id="同期ユーザー"><a href="#同期ユーザー" class="headerlink" title="同期ユーザー"></a>同期ユーザー</h3><p>同期ユーザーに適用されるオンプレミス AD 側のポリシーは、有効期限と同様、[アカウント ポリシー] 内の [パスワードのポリシー] から変更できます。<br>たとえば、以下の [パスワードの長さ] を変更することで、長さを 6 文字以上などと短縮したり、 10 文字以上などより厳しいポリシーに設定したりすることも可能です。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy2.png"></p><h3 id="クラウド-ユーザー"><a href="#クラウド-ユーザー" class="headerlink" title="クラウド ユーザー"></a>クラウド ユーザー</h3><p>クラウド ユーザーに適用される Azure AD のパスワード ポリシーは、有効期限を除いてポリシーを変更することができません。Azure AD のパスワード ポリシーの詳細は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-sspr-policy#azure-ad-password-policies">こちらの公開情報</a> もご利用ください。  </p><p>クラウド ユーザーのパスワードの複雑性 (図の△部分) については、オンプレミス側と同じような設定が用意されているわけではありませんが、グローバル禁止リスト・カスタム禁止リストの機能が用意されています。グローバル禁止リストは、どのテナントでも有効になっており、無効化することはできません。 admin や baseball などの脆弱なパスワードを排除します。カスタム禁止リストは、お客様の会社名や会社の略称などを登録し、パスワードに使用できないよう禁止する機能です。詳細につきましては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-password-ban-bad#global-banned-password-list">本公開情報</a> をご確認ください。  </p><h3 id="ゲスト-ユーザー"><a href="#ゲスト-ユーザー" class="headerlink" title="ゲスト ユーザー"></a>ゲスト ユーザー</h3><p>ゲスト ユーザーについては、ゲストがもともとメンバーとして登録されている “ホーム テナント” の設定に準じます。そのため、ゲスト ユーザーに対しどのようなポリシーが適用されているか確認したい場合は、ホーム テナント側の管理者に確認を依頼ください。</p><h2 id="C-認証時に評価されるポリシー-有効期限"><a href="#C-認証時に評価されるポリシー-有効期限" class="headerlink" title="C. 認証時に評価されるポリシー (有効期限)"></a>C. 認証時に評価されるポリシー (有効期限)</h2><p>有効期限は、1 つのパスワードを最大何日間使用できるかを指定する項目です。この期限を迎えると、ユーザーは次回サインインする際にパスワードを新しいものに変更する必要があります。有効期限について考える時は、同期ユーザー or クラウド ユーザーなのかという観点のほかに、 “オンプレミス側 or クラウド側のどちらで認証が行われているか” を考慮するとわかりやすくなります。それぞれのシナリオごとに詳細を記載しておりますので、確認されたいユーザーの種類と環境が該当する項目をご確認ください。</p><h3 id="シナリオ-C-1-パスワード-ハッシュ同期環境の同期ユーザー"><a href="#シナリオ-C-1-パスワード-ハッシュ同期環境の同期ユーザー" class="headerlink" title="シナリオ C-1: パスワード ハッシュ同期環境の同期ユーザー"></a>シナリオ C-1: パスワード ハッシュ同期環境の同期ユーザー</h3><p>同期ユーザーの場合、オンプレミス AD 側の有効期限がそのまま Azure AD 側に同期されていると誤解されていることがあります。しかしながら、同期ユーザーのパスワード有効期限は、オンプレミス AD 側と Azure AD 側のそれぞれで値を保持しています。パスワードの情報はオンプレミス AD と Azure AD の双方にあるため、「ユーザーがどこにサインインするか (どこで認証されるか)」によって、適用される有効期限が異なります。</p><p>例えば、ドメイン参加しているクライアント端末にログオンする際は、認証はオンプレミス AD にて行われるため、オンプレミス AD のパスワード有効期限が適用されます。Azure ポータルや Microsoft 365 にサインインする際は、Azure AD 側の有効期限設定が適用されます。オンプレミス AD のパスワード有効期限を迎えると、次のオンプレミス AD へのサインインの際にオンプレミス側でパスワードの変更が要求されます。パスワードを変更すると、そのパスワードが Azure AD にも反映され、新しいパスワードで Azure AD にもサインインできるようになります。</p><p>しかしながら、パスワード ハッシュ同期では、同期ユーザーの Azure AD 側のパスワード有効期限は無期限とするよう個別に設定されています。このため、オンプレミス AD のパスワード有効期限が切れたあとも、オンプレミス側で有効期限切れのパスワードにて Azure AD 側にサインインできます。オンプレミス側で新しいパスワードに変更し、それが Azure AD に同期されると、Azure AD にその新しいパスワードでサインイン可能となります。オンプレミス側で有効期限が切れているパスワードで Azure AD にサインインさせたくない場合は、EnforceCloudPasswordPolicyForPasswordSyncedUsers のオプションをオンにして、 Azure AD 側のパスワード ポリシーを無期限にしないよう設定します (詳細を補足 D にて記載しています)。</p><h3 id="シナリオ-C-2-パススルー認証や-AD-FS-環境などオンプレミス側で認証を行う同期ユーザー"><a href="#シナリオ-C-2-パススルー認証や-AD-FS-環境などオンプレミス側で認証を行う同期ユーザー" class="headerlink" title="シナリオ C-2: パススルー認証や AD FS 環境などオンプレミス側で認証を行う同期ユーザー"></a>シナリオ C-2: パススルー認証や AD FS 環境などオンプレミス側で認証を行う同期ユーザー</h3><p>パススルー認証や AD FS を利用している場合、Azure ポータルや Microsoft 365 にサインインする際の認証は Azure AD ではなく、オンプレミス AD にて行われます。そのため、Azure ポータルにサインインした際などにも、適用されるのはオンプレミス AD の有効期限ポリシーです。</p><p>また、パスワードの有効期限を確認したい場合は、オンプレミス AD のパスワード ポリシーを確認します。オンプレミス AD のパスワード ポリシーは、グループ ポリシー管理コンソールより Default Domain Policy を編集し、[アカウント ポリシー] - [パスワード ポリシー] を開くことで確認できます。</p><p>なお、アカウント ポリシーは、ドメインにリンクされた 1 つの GPO でのみ定義することが可能です。そのため、以下のように Default Domain Policy を編集して設定ください。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy3.png"></p><h3 id="シナリオ-C-3-Azure-AD-に直接作成したクラウド-ユーザーの場合"><a href="#シナリオ-C-3-Azure-AD-に直接作成したクラウド-ユーザーの場合" class="headerlink" title="シナリオ C-3: Azure AD に直接作成したクラウド ユーザーの場合"></a>シナリオ C-3: Azure AD に直接作成したクラウド ユーザーの場合</h3><p>Azure AD で直接作成したクラウド ユーザーに対しては、パスワードの有効期限として Azure AD のパスワード ポリシーで指定された日数が適用されます。この日数を過ぎると、Azure AD にサインインする際にパスワードの変更要求が表示されます。</p><p>Azure AD のパスワード有効期限は、Microsoft 365 管理センターもしくは PowerShell から変更可能です。手順は以下のとおりです。</p><ol><li>Microsoft 365 管理センターを開きます。</li><li>[設定] - [組織設定] - [セキュリティとプライバシー] タブ内の [パスワードの有効期限ポリシー] を選択します。<br><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy4.png"></li><li>設定値を確認します。以下の画像では、パスワードの有効期限が 90 日に設定されています。<br><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy5.png"></li><li>パスワードの有効期限を無期限にしたい場合は、以下のようにチェックボックスをオフにします。<br><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy6.png"></li></ol><div class="alert is-success"><p class="alert-title">ヒント</p><p>上記の設定でパスワード有効期限を 90 日などに設定している環境でも、システム用アカウントなど、一部のユーザーだけ無期限にしたいシナリオがあるかと思います。</p><p>この場合は、上記の設定に加え、そのアカウントに対してのみ Set-AzureADUser コマンドで DisablePasswordExpiration を設定することで、個別に無期限にできます。</p><p>詳細は、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/add-users/set-password-to-never-expire?view=o365-worldwide">個別のユーザーのパスワードを無期限に設定する</a> の情報をご確認ください。  </p></div><h3 id="シナリオ-C-4-ゲスト-ユーザー"><a href="#シナリオ-C-4-ゲスト-ユーザー" class="headerlink" title="シナリオ C-4: ゲスト ユーザー"></a>シナリオ C-4: ゲスト ユーザー</h3><p>ゲスト ユーザーのパスワード有効期限は、ゲストがもともと登録されているホーム テナントの組織で管理されています。そのため、ゲストを招待したテナント側 (リソース テナント側) では管理する必要がなく、ホーム テナント側の組織の設定を確認します。ゲスト ユーザーが <a href="mailto:&#x75;&#115;&#x65;&#114;&#64;&#x6f;&#117;&#x74;&#108;&#x6f;&#x6f;&#107;&#46;&#99;&#111;&#x6d;">&#x75;&#115;&#x65;&#114;&#64;&#x6f;&#117;&#x74;&#108;&#x6f;&#x6f;&#107;&#46;&#99;&#111;&#x6d;</a> などの Microsoft アカウントの場合は、各サービスで定義されているパスワード ポリシーが適用されます。</p><h2 id="D-補足情報-FAQ"><a href="#D-補足情報-FAQ" class="headerlink" title="D. 補足情報 (FAQ)"></a>D. 補足情報 (FAQ)</h2><p>パスワード ポリシー関連でよくある質問をおまとめしております。  </p><h3 id="Q-パスワード-ハッシュ同期の環境で、オンプレミス-AD-側の有効期限が切れたときに、-Azure-AD-側に引き続き古いパスワードでアクセスできてしまいます。同期ユーザーの-Azure-AD-側のパスワードの有効期限を無期限から変更することはできますか。"><a href="#Q-パスワード-ハッシュ同期の環境で、オンプレミス-AD-側の有効期限が切れたときに、-Azure-AD-側に引き続き古いパスワードでアクセスできてしまいます。同期ユーザーの-Azure-AD-側のパスワードの有効期限を無期限から変更することはできますか。" class="headerlink" title="Q: パスワード ハッシュ同期の環境で、オンプレミス AD 側の有効期限が切れたときに、 Azure AD 側に引き続き古いパスワードでアクセスできてしまいます。同期ユーザーの Azure AD 側のパスワードの有効期限を無期限から変更することはできますか。"></a><span style="color: blue; ">Q:</span> パスワード ハッシュ同期の環境で、オンプレミス AD 側の有効期限が切れたときに、 Azure AD 側に引き続き古いパスワードでアクセスできてしまいます。同期ユーザーの Azure AD 側のパスワードの有効期限を無期限から変更することはできますか。</h3><p><span style="color: red; ">A:</span> はい、テナント側の EnforceCloudPasswordPolicyForPasswordSyncedUsers オプションを適用することで可能です。 Azure AD 側からパスワードを変更するためには、Azure AD Connect でパスワード ライトバックを有効にする必要もあります。</p><p>以下のコマンドを実行すると、Azure AD 側のユーザーにもパスワード有効期限を設定することができます。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-MsolDirSyncFeature</span> <span class="literal">-Feature</span> EnforceCloudPasswordPolicyForPasswordSyncedUsers <span class="literal">-Enable</span> <span class="variable">$true</span></span><br></pre></td></tr></table></figure><div class="alert is-warning"><p class="alert-title">警告</p><p>同期ユーザーのパスワード有効期限自体は、オンプレミス側から Azure AD 側に同期されていません。</p><p>この機能を有効にすると、オンプレミス側にサインインする際はオンプレミス側のポリシー、 Azure AD 側で認証を行う際は Azure AD 側のポリシーが適用されることとなり、ユーザーが “どこにサインインするか” で適用される有効期限ポリシーが変わります。</p><p>オンプレミスと Azure AD の各ポリシーで異なるパスワード有効期限の日数 (例: オンプレミス側ポリシーは 30 日、Azure AD 側は 90 日) を設定していると、パスワードがいつ有効期限切れとなるかがわかりにくくなるため、オンプレミス側のポリシーと Azure AD 側のポリシーで設定する有効期限は、同じ日数にすることをお勧めします。</p><p>たとえば、オンプレミスと Azure AD の両方のポリシーで 90 日後にパスワードを変更するように設定されていれば、ほぼ同じタイミングで両方のパスワードが期限切れとなる動作となります。</p><p>また、オンプレミス側もしくは Azure AD 側のどちらかでパスワードを変更すれば、パスワードハッシュ同期およびパスワード ライトバック機能により変更内容が同期され、経過日数がリセットされます。</p></div><h3 id="Q-次回ログオン時にパスワードの変更が必要-をオンプレミス側で設定すると、Azue-AD-側にサインインした時に-“パスワードが間違っている”-旨のエラーが表示されてしまいます。Azure-AD-側で一時パスワードから新しいものに変更させることはできますか"><a href="#Q-次回ログオン時にパスワードの変更が必要-をオンプレミス側で設定すると、Azue-AD-側にサインインした時に-“パスワードが間違っている”-旨のエラーが表示されてしまいます。Azure-AD-側で一時パスワードから新しいものに変更させることはできますか" class="headerlink" title="Q:  [次回ログオン時にパスワードの変更が必要] をオンプレミス側で設定すると、Azue AD 側にサインインした時に “パスワードが間違っている” 旨のエラーが表示されてしまいます。Azure AD 側で一時パスワードから新しいものに変更させることはできますか?"></a><span style="color: blue; ">Q:</span>  [次回ログオン時にパスワードの変更が必要] をオンプレミス側で設定すると、Azue AD 側にサインインした時に “パスワードが間違っている” 旨のエラーが表示されてしまいます。Azure AD 側で一時パスワードから新しいものに変更させることはできますか?</h3><p><span style="color: red; ">A:</span> はい、テナント側の ForcePasswordChangeOnLogOn オプションを有効化することで可能です。 Azure AD 側からパスワードを変更するために、Azure AD Connect でパスワード ライトバックの機能を有効に設定ください。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-ADSyncAADCompanyFeature</span> <span class="literal">-ForcePasswordChangeOnLogOn</span> <span class="variable">$true</span></span><br></pre></td></tr></table></figure><p>既定では上記機能は無効のため、事前にオンプレミス側でパスワードを変更しないと、以下のようにエラーになってしまいます。上記のコマンドを実行すると、Azure AD 側で新しいパスワードへの変更要求画面が表示されるようになります。この機能については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-password-hash-synchronization#enforcecloudpasswordpolicyforpasswordsyncedusers">公開情報の記載</a> もご確認ください。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy7.png">  </p><h3 id="Q-Microsoft-365-管理センターで確認できるパスワード有効期限の既定値は何日ですか？"><a href="#Q-Microsoft-365-管理センターで確認できるパスワード有効期限の既定値は何日ですか？" class="headerlink" title="Q: Microsoft 365 管理センターで確認できるパスワード有効期限の既定値は何日ですか？"></a><span style="color: blue; ">Q:</span> Microsoft 365 管理センターで確認できるパスワード有効期限の既定値は何日ですか？</h3><p><span style="color: red; ">A:</span> 以前は 90 日に設定されていましたが、 2021 年の春頃以降新しく作成されたテナントは、既定値が無期限となりました (そのため、既定値が無期限のテナントと、 90 日のテナントがあります)。</p><h3 id="Q-Azure-AD-のパスワード-ポリシーがいつのまにか無期限になっています。誰が変更したか確認する方法はありますか？"><a href="#Q-Azure-AD-のパスワード-ポリシーがいつのまにか無期限になっています。誰が変更したか確認する方法はありますか？" class="headerlink" title="Q: Azure AD のパスワード ポリシーがいつのまにか無期限になっています。誰が変更したか確認する方法はありますか？"></a><span style="color: blue; ">Q:</span> Azure AD のパスワード ポリシーがいつのまにか無期限になっています。誰が変更したか確認する方法はありますか？</h3><p><span style="color: red; ">A:</span> 直近でポリシーが変更されている場合は、Azure AD の監査ログで確認することが可能です。Set password policy のアクティビティでフィルターをかけたのちに、開始者（アクター）に記載のユーザーを確認ください。</p><h3 id="Q-PowerShell-で-Get-MsolPasswordPolicy-コマンドを実行し、テナントに設定されているパスワード有効期限を調べました。2147483647-日と表示されるのですが、どのような意味ですか？"><a href="#Q-PowerShell-で-Get-MsolPasswordPolicy-コマンドを実行し、テナントに設定されているパスワード有効期限を調べました。2147483647-日と表示されるのですが、どのような意味ですか？" class="headerlink" title="Q: PowerShell で Get-MsolPasswordPolicy コマンドを実行し、テナントに設定されているパスワード有効期限を調べました。2147483647 日と表示されるのですが、どのような意味ですか？"></a><span style="color: blue; ">Q:</span> PowerShell で Get-MsolPasswordPolicy コマンドを実行し、テナントに設定されているパスワード有効期限を調べました。2147483647 日と表示されるのですが、どのような意味ですか？</h3><p><span style="color: red; ">A:</span> テナントのパスワード有効期限が無期限になっていることを示しています。  </p><h3 id="Q-Microsoft-365-管理センターや-PowerShell-からパスワード-ポリシーを編集しましたが、期限切れの通知が来ません。"><a href="#Q-Microsoft-365-管理センターや-PowerShell-からパスワード-ポリシーを編集しましたが、期限切れの通知が来ません。" class="headerlink" title="Q: Microsoft 365 管理センターや PowerShell からパスワード ポリシーを編集しましたが、期限切れの通知が来ません。"></a><span style="color: blue; ">Q:</span> Microsoft 365 管理センターや PowerShell からパスワード ポリシーを編集しましたが、期限切れの通知が来ません。</h3><p><span style="color: red; ">A:</span> 以前は Microsoft 365 ポータルの右上にベル アイコンが表示されていましたが、通知設定自体が廃止されたため、”もうすぐ期限切れ” の通知は現在送信されません。</p><h3 id="Q-Azure-AD-Join-している端末にサインインしています。パスワードが切れているのに、端末にサインインできてしまうのですが、いつパスワード変更が求められますか？"><a href="#Q-Azure-AD-Join-している端末にサインインしています。パスワードが切れているのに、端末にサインインできてしまうのですが、いつパスワード変更が求められますか？" class="headerlink" title="Q: Azure AD Join している端末にサインインしています。パスワードが切れているのに、端末にサインインできてしまうのですが、いつパスワード変更が求められますか？"></a><span style="color: blue; ">Q:</span> Azure AD Join している端末にサインインしています。パスワードが切れているのに、端末にサインインできてしまうのですが、いつパスワード変更が求められますか？</h3><p><span style="color: red; ">A:</span> 端末にログオンし、Windows のデスクトップを表示するところまでは、パスワードが切れていても実施できます。Azure ポータルや Microsoft 365 管理センター、Exchange Online など Azure AD と連携するクラウド上のリソースにサインインした時にパスワード変更が求められます。 </p><p>端末に UPN (例: <a href="mailto:&#x75;&#x73;&#x65;&#114;&#x40;&#99;&#111;&#110;&#x74;&#111;&#x73;&#x6f;&#x2e;&#x6f;&#x6e;&#x6d;&#105;&#99;&#x72;&#111;&#x73;&#x6f;&#102;&#116;&#46;&#x63;&#111;&#x6d;">&#x75;&#x73;&#x65;&#114;&#x40;&#99;&#111;&#110;&#x74;&#111;&#x73;&#x6f;&#x2e;&#x6f;&#x6e;&#x6d;&#105;&#99;&#x72;&#111;&#x73;&#x6f;&#102;&#116;&#46;&#x63;&#111;&#x6d;</a>) などでサインインした場合には、端末ログオン後、右下に以下のメッセージが表示される動作を現時点で確認しております。こちらもパスワード変更の際の目安となりましたら幸いです。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy8.png"></p><h3 id="Q-テナントに設定されている値ではなく、各ユーザーのパスワード有効期限を知りたいです。方法はありますか？"><a href="#Q-テナントに設定されている値ではなく、各ユーザーのパスワード有効期限を知りたいです。方法はありますか？" class="headerlink" title="Q: テナントに設定されている値ではなく、各ユーザーのパスワード有効期限を知りたいです。方法はありますか？"></a><span style="color: blue; ">Q:</span> テナントに設定されている値ではなく、各ユーザーのパスワード有効期限を知りたいです。方法はありますか？</h3><p><span style="color: red; ">A:</span> Azure ポータル上から簡単に確認することはできません。 PowerShell で取得した値をもとに計算ください。  </p><p>テナントに設定されている有効期限を確認するには以下のように実施ください。</p><ol><li>Connect-MsolService コマンドを実行します。</li><li>Get-Msoldomain コマンドを実行し、正しいテナントに接続できているか確認します。</li><li>下記のコマンドを実行し、テナントのパスワード有効期限ポリシーを確認します。この例では、パスワードの有効期限が切れるまでの日数（ValidityPeriod）は 90 日となります。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MsolPasswordPolicy</span> <span class="literal">-DomainName</span> contoso.onmicrosoft.com</span><br></pre></td></tr></table></figure><p>例として、以下のようにコマンド実行結果が表示されます。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ExtensionData                                    NotificationDays ValidityPeriod</span><br><span class="line">-------------                                    ---------------- --------------  </span><br><span class="line">System.Runtime.Serialization.ExtensionDataObject               <span class="number">14</span>             <span class="number">90</span></span><br></pre></td></tr></table></figure><p>ユーザーが最後にパスワードを変更した日時を取得するには以下のようにします。</p><ol start="4"><li>引き続き、PowerShell より以下のコマンドを実行します。  </li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MsolUser</span> <span class="literal">-UserPrincipalName</span> user@contoso.onmicrosoft.com | <span class="built_in">ft</span> UserPrincipalName, LastPasswordChangeTimestamp</span><br></pre></td></tr></table></figure><p>コマンドの実行結果の例は以下のとおりです。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">UserPrincipalName                   LastPasswordChangeTimestamp</span><br><span class="line">-----------------                   --------------------------- </span><br><span class="line">user@consoto.onmicrosoft.com        <span class="number">2021</span>/<span class="number">02</span>/<span class="number">02</span> <span class="number">16</span>:<span class="number">11</span>:<span class="number">54</span></span><br></pre></td></tr></table></figure><ol start="5"><li>現在の日付を確認し、パスワードを最後に変更した日付とパスワード有効期限の日数と比較し、有効期限を確認します。</li></ol><h3 id="Q-“パスワードの変更”-と”パスワード-リセット”-は同じ意味ですか？どのような違いがありますか？"><a href="#Q-“パスワードの変更”-と”パスワード-リセット”-は同じ意味ですか？どのような違いがありますか？" class="headerlink" title="Q: “パスワードの変更” と”パスワード リセット” は同じ意味ですか？どのような違いがありますか？"></a><span style="color: blue; ">Q:</span> “パスワードの変更” と”パスワード リセット” は同じ意味ですか？どのような違いがありますか？</h3><p><span style="color: red; ">A:</span> パスワードの管理において混乱しやすいポイントの一つですが、パスワードの変更とリセットには、以下のような違いがあります。  </p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy9.png"></p><p>パスワードの変更は、ユーザーが現在のパスワードを知っている場合に、ユーザーが自ら新しいパスワードに変更するものです。変更を行う際は、現在のパスワード (古いパスワード) を入力する必要があります。<br>たとえば、下記の要求画面もパスワード変更に該当します。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy10.png">  </p><p>また、パスワードの有効期限が切れていない状態でも、以下のように、マイ アカウントの画面からパスワードを明示的に変更することが可能です。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy11.png"></p><p>一方、パスワードのリセットは、ユーザーが現在のパスワードを必ずしも知っている必要はありません。パスワードを知っている場合でもリセットを行うことはできますが、パスワードがわからない、忘れた場合などにリセットを行うシナリオが一般的です (その他、発生したリスクへの対応を行うために、パスワードのリセットが必要なシナリオなどもあります)。</p><p>ユーザーが自身でパスワードのリセットを行う際は、以下のように、[アカウントを回復する] の画面が表示されます。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy12.png"></p><h3 id="Q-ユーザーに-“パスワードの変更”-をさせない方法はありますか？"><a href="#Q-ユーザーに-“パスワードの変更”-をさせない方法はありますか？" class="headerlink" title="Q: ユーザーに “パスワードの変更” をさせない方法はありますか？"></a><span style="color: blue; ">Q:</span> ユーザーに “パスワードの変更” をさせない方法はありますか？</h3><p><span style="color: red; ">A:</span> いいえ、ユーザーは自身のパスワードをいつでも変更できます。 ユーザー自身がパスワードをリセットする SSPR の機能は、管理者が無効にすることもできます。  </p><h3 id="Q-特定の文字列をパスワードに使用させたくありません。何か方法はありますか？"><a href="#Q-特定の文字列をパスワードに使用させたくありません。何か方法はありますか？" class="headerlink" title="Q: 特定の文字列をパスワードに使用させたくありません。何か方法はありますか？"></a><span style="color: blue; ">Q:</span> 特定の文字列をパスワードに使用させたくありません。何か方法はありますか？</h3><p><span style="color: red; ">A:</span> 会社名などをパスワードに入れることを禁止したい場合は、カスタム禁止パスワード リストに文字列を追加ください。なお、Admin や Password など明らかに脆弱なパスワードは、グローバル禁止リストで拒否されているため、別途の登録は不要です (グローバル禁止リストは、全テナントに自動で適用されているリストです。具体的な禁止リストの一覧はセキュリティ上公開できません)。</p><h3 id="Q-グローバル禁止リストやカスタム禁止パスワードはいつ評価されますか？"><a href="#Q-グローバル禁止リストやカスタム禁止パスワードはいつ評価されますか？" class="headerlink" title="Q: グローバル禁止リストやカスタム禁止パスワードはいつ評価されますか？"></a><span style="color: blue; ">Q:</span> グローバル禁止リストやカスタム禁止パスワードはいつ評価されますか？</h3><p><span style="color: red; ">A:</span> パスワード変更時およびリセット時に評価されます。ただし、カスタム禁止リストに登録したワードであっても、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-password-ban-bad#how-are-passwords-evaluated">公開情報</a> に記載のパスワード評価の結果によっては、パスワードが受け入れられる可能性があります。  </p><h3 id="Q-同期ユーザーが-Azure-AD-側からパスワードを変更しようとしています。毎回「数分お待ちください」-の画面が表示されるのですが、なぜですか？"><a href="#Q-同期ユーザーが-Azure-AD-側からパスワードを変更しようとしています。毎回「数分お待ちください」-の画面が表示されるのですが、なぜですか？" class="headerlink" title="Q: 同期ユーザーが Azure AD 側からパスワードを変更しようとしています。毎回「数分お待ちください」 の画面が表示されるのですが、なぜですか？"></a><span style="color: blue; ">Q:</span> 同期ユーザーが Azure AD 側からパスワードを変更しようとしています。毎回「数分お待ちください」 の画面が表示されるのですが、なぜですか？</h3><p><span style="color: red; ">A:</span> Azure AD のパスワード ポリシーを満たしていないものの、オンプレミス AD のパスワード ポリシーを満たしているパスワードを指定しているためです。たとえば、オンプレミス AD のパスワード ポリシーで、文字数を 7 文字以下にしていたり、複雑性の設定を無効にしていたりする場合に発生します。  </p><p>同期ユーザーのパスワード ポリシーは、基本的にオンプレミス側の設定で制御していますが、パスワード変更およびリセットを Azure AD 側から行う場合は、Azure AD 側でもポリシーのチェックが行われています。Azure AD のパスワード ポリシーも満たすようなパスワードに変更した場合 (例: 8 文字以上、大文字・小文字・数字・記号のうち 3 つ以上使うなど）は、即座に Azure AD 側のパスワードが変更されるため、「数分お待ちください」の画面は表示されません。  </p><p>しかしながら、オンプレミス AD 側のポリシーが Azure AD のポリシーより「緩く」設定されている環境で、オンプレミス側のポリシーのみを満たすパスワードに変更すると、この Azure AD 側のチェックをパスせず、 Azure AD 側のパスワードを直接変更することができません。オンプレミス側ではパスワードが受け入れられているため、 Azure AD Connect 経由でパスワード ハッシュ同期 (2 分毎) が行われると、Azure AD 側でも新しいパスワードに正常に変更されます。特にエラー メッセージではないため対処の必要はありませんが、次回のパスワード ハッシュ同期までの最大 2 分程度、パスワードが完全に反映されるまでに時間がかかる点にご留意ください。</p><h3 id="Q-マイクロソフトが推奨するパスワード-ポリシーはありますか？"><a href="#Q-マイクロソフトが推奨するパスワード-ポリシーはありますか？" class="headerlink" title="Q: マイクロソフトが推奨するパスワード ポリシーはありますか？"></a><span style="color: blue; ">Q:</span> マイクロソフトが推奨するパスワード ポリシーはありますか？</h3><p>マイクロソフトが推奨するパスワード ポリシーは、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/misc/password-policy-recommendations?view=o365-worldwide">パスワード ポリシーの推奨事項</a> にまとめられています。以下に概要をおまとめします。</p><ul><li>最小文字数を 8 桁にする</li><li>文字構成 (複雑さ) の要件を求めない (たとえば、*&amp;(^%$ などを必須としない)</li><li>ユーザーに定期的なパスワード変更を求めない</li><li>よく使われるパスワードの文字列を禁止する</li><li>業務以外の目的で組織のパスワードを再利用しない</li></ul><p>頻繁なパスワード変更や記号を用いた複雑なパスワードを強制したいというお客様は少なくありません。しかしながらそのような厳しいポリシーでは反対にセキュリティが低下することが研究により明らかになっています。これは、ユーザーが似たパスワードを使いまわしたり、推測しやすいパスワードを使う傾向にあるためです。頻繁なパスワード変更や記号を用いた複雑なパスワードを強制するという古い常識にとらわれず、上記資料をベースにした適切なパスワード管理に取り組んでいただければ幸いです。</p><p>Azure AD ではパスワードを利用しないサインインも推奨しておりますので、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-passwordless">Azure AD のパスワードレス認証</a> についても今後ご検討いただければと思います。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;今日は、混乱しやすい Azure AD のパスワード ポリシーについて、どのユーザーにどの項目が該当するか、同期ユーザーとクラウド ユーザーの観点からそれぞれご案内します。&lt;/p&gt;
&lt;h2 id=&quot;はじめに&quot;</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="SSPR" scheme="https://jpazureid.github.io/blog/tags/SSPR/"/>
    
    <category term="Password Policy" scheme="https://jpazureid.github.io/blog/tags/Password-Policy/"/>
    
  </entry>
  
  <entry>
    <title>Deep dive - Azure AD Kerberos の仕組み</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/how-azuread-kerberos-works/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/how-azuread-kerberos-works/</id>
    <published>2022-02-25T15:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.349Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>本記事は、 2022 年 1 月 25 日に米国の ITOps Talk Blog で公開された <a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-how-azure-ad-kerberos-works/ba-p/3070889">Deep dive: How Azure AD Kerberos works</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>Active Directory (AD DS) と Azure Active Directory (Azure AD) の違いを調べたことがあれば、Active Directory は Kerberos 認証プロトコルをサポートしている一方、Azure Active Directory ではサポートしていないことに気がつくはずです。</p><p>Kerberos は、Active Directory ドメイン コントローラーでアカウントを認証するために使用されています。このおかげで、SMB プロトコルにて Windows Server 上のファイル共有にアクセスすることができます。これはほんの一例で、あなたの組織が昔作成したものも含め、多くのアプリケーションが Kerberos 認証に依存しています。ローカル Windows へのログオン プロセスがどのように動作しているかや、いつ、どのように Kerberos が動作するかなどの詳細については、<a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-logging-on-to-windows/ba-p/2420705?WT.mc_id=modinfra-54539-socuff">Deep dive: Logging on to Windows</a> をご覧ください。</p><p>Kerberos 認証や、古いアプリケーション用に Windows Server を Azure 上でホストする場合、Azure Active Directory Domain Services (Azure AD DS) のマネージド ドメインを作成することになります。このディレクトリは、Azure AD からアカウントを同期しますが、同時に Azure AD 上のアカウントはオンプレミスの Active Directory ドメインから同期されているものの可能性もあります。これにより、Azure 上に Active Directory ドメイン コントローラーを導入することなく、Azure 仮想マシンをドメイン参加させ、グループ ポリシーを適用できるようになります。Azure AD DS にはいくつかの制限がありますが、これが Azure で Kerberos をサポートするための標準的な方法になります。</p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works1.png" alt="Active Directory、Azure Active Directory、Azure AD Domain Servicesのハイブリッド環境">  </p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory-domain-services/overview?WT.mc_id=modinfra-54539-socuff">Azure AD DS についての詳細はこちらへ</a></p><p>アプリケーションを刷新するために他の選択肢がない場合や、そのための時間を確保できない場合にのみ、この方法を取ることをお勧めします。<a href="https://syfuhs.net/why-we-built-azure-ad-kerberos">Why We Built Azure AD Kerberos</a> の中で、Steve Syfuhs 氏は、「Active Directory で使われている Kerberos はパスワードに依存しており、FIDO や多要素認証、条件付きアクセスのような機能をサポートしていない」と述べています。オンプレミスでこれらの機能の一部をサポートするソリューションもありますが、Azure AD のチェックボックスを選択して構成するのに比べると複雑な方法になります。</p><h2 id="具体的な使用例として-Azure-Virtual-Desktop-用の-FSLogix-を使用したプロファイル-コンテナについて見てみる"><a href="#具体的な使用例として-Azure-Virtual-Desktop-用の-FSLogix-を使用したプロファイル-コンテナについて見てみる" class="headerlink" title="具体的な使用例として Azure Virtual Desktop 用の FSLogix を使用したプロファイル コンテナについて見てみる"></a>具体的な使用例として Azure Virtual Desktop 用の FSLogix を使用したプロファイル コンテナについて見てみる</h2><p>仮想デスクトップやリモート デスクトップの世界では、複数の人が 1 つのサーバーにログオンして、自分だけの一時的なリモート セッションを利用できるサービスが存在します。既定のデスクトップ設定やアイコンを設定でき、PC 上で実行しているのと同じようにアプリケーションを実行できます。これは、すべてのコンピューターのローカルにインストールして実行させたくないような、ブラウザー以外の業務用アプリケーションへのアクセスを集中管理するのに非常に便利なものです。マイクロソフトは、1996 年に Windows NT 4.0 Terminal Server Edition で “リモート デスクトップ サービス” をリリースして以来、このような仮想化を提供してきました。</p><p>ユーザーが Windows デスクトップにログインするにあたり、ユーザー プロファイルという概念が生まれました。これは、デスクトップの背景色、スクリーン セーバー、オート コンプリートの項目などを含む、そのユーザー用の環境設定です。ローカル コンピューターでは、そのユーザー プロファイルはローカル ディスクに保存されます。「移動ユーザー プロファイル」を設定した場合、これらの設定は代わりにサーバーに保存され、ネットワーク ドライブのファイル共有 (通常はユーザーの「ホーム」ドライブと呼ばれます) にマッピングされますので、ドメインに参加している組織内のどのコンピューターにログオンしても、これらの設定が適用されます。</p><p>FSLogix は、特に非永続的な仮想環境 (仮想デスクトップ) のユーザー プロファイルをネットワーク共有の場所に保持し、同時にプロファイルがネットワーク共有にあることをアプリから見てわからなくするように設計されています。このように透過的なプロファイル構成を実現することは、ユーザー プロファイルをローカルに保存する必要がある一部のアプリケーションにとって重要です。</p><p>つまり、仮想デスクトップ環境が Azure Virtual Desktop で、ユーザー プロファイルをファイル共有に置きたい場合、Azure Files のようなものを使えばよいということになります。Azure Files は SMB ファイル共有プロトコルをサポートしているので、Windows PC から Azure Files に接続することができます。少し設定するだけで、Windows クライアントが Active Directory で認証したときに受け取ったチケットを Azure Files が解読し、受けつけてくれるからです。</p><p>Azure Virtual Desktop がドメイン参加もしくは Azure AD 参加している場合、VPN 経由で Active Directory ドメイン コントローラーにアクセスできるよう構成されているか、Azure の仮想マシンとして動作している Active Directory ドメイン コントローラに接続できるかしない限り、Azure Virtual Desktop はユーザーを認証することができません。こういった様々な基盤への依存や管理を減らそうとしているのに、反対に依存関係が増えることになってしまいます。これを解決するために、ID チームは FIDO とのハイブリッド認証に使用される Ticket-Granting Ticket (TGT) について着目しました。</p><h2 id="認証プロセス"><a href="#認証プロセス" class="headerlink" title="認証プロセス"></a>認証プロセス</h2><p>認証に関してどのくらいの知識があるかにもよりますが、参考としてこの 2 つの記事を読み返してみるのがおすすめです。</p><p><a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-logging-on-to-windows/ba-p/2420705?WT.mc_id=modinfra-54539-socuff">Deep dive: Logging on to Windows</a><br><a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-windows-hybrid-join-single-sign-on-to-azure-active/ba-p/2602107">Deep dive: Windows hybrid join single-sign on to Active Directory</a>  </p><p> 下の図は、Windows Local Security Authority が認証情報を保持していることを通知し、どの認証パッケージが Azure AD に対応しているかを確認し、さらに Cloud Authentication Provider パッケージ (CloudAP) が応答して AAD プラグインを使用し、OAuth プロトコルを使って Azure AD と通信しているところを示しています。  </p><p>ユーザーの認証情報が検証されると、OAuth Primary Refresh Token (PRT) が発行されます。この PRT は、特定のデバイス上の特定のユーザーに対して発行され、デバイス ID とセッション キーが含まれています。</p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works2.png" alt="Azure Active Directory から OAuth PRT を取得する Windows ローカルセキュリティ権限">  </p><h2 id="Titkcet-Granting-Ticket-と-Realm"><a href="#Titkcet-Granting-Ticket-と-Realm" class="headerlink" title="Titkcet Granting Ticket と Realm"></a>Titkcet Granting Ticket と Realm</h2><p>Kerberos は PRT を使用せず、TGT (Ticket Granting Tickets - 特に krbtgt) を使用します。  </p><p>Microsoft は、<a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-windows-hybrid-join-single-sign-on-to-azure-active/ba-p/2602107">FIDO セキュリティ キーの認証プロセスに、クラウドが発行した特別な Kerberos TGT</a> を使用する機能を追加しました。しかし、この機能では依然としてオンプレミスのサーバーを参照して、クラウドから発行された kerberos TGT を完全なオンプレミス TGT と交換する必要があります。必要とするすべてのコンポーネントが用意されているわけではないため、チームはクラウド TGT を開発したというわけです。</p><h2 id="Azure-AD-の-Kerberos-認証プロセス"><a href="#Azure-AD-の-Kerberos-認証プロセス" class="headerlink" title="Azure AD の Kerberos 認証プロセス"></a>Azure AD の Kerberos 認証プロセス</h2><p>Windows は Azure AD と認証し、PRT と クラウド TGT (FIDO キーでログオンした場合は、さらに Patrtial TGT) を取得します。 ここでの課題は、プライマリ TGT は、1 つのレルム (オンプレミス AD) に対して 1 つだけ持つことになっていることです。そこでこのプロセスでは、クライアントに対しクラウドのリソースについては別のレルムにマッピングするよう指示し、Azure AD のテナントの詳細についても併せて取得します。  </p><p>*.windows.net = KERBEROS.MICROSOFTONLINE.COM  </p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works3.png" alt="Azure AD から Kerberos のクラウド TGT、レルム マッピング、Azure テナント情報を取得している Windows LSASS">  </p><p>Azure Virtual Desktop にログインし、認証して PRT と クラウド TGT を取得すると、Azure Virtual Desktop は FSLogix を呼び出して Azure Files 共有 (例: \mystuff.file.core.windows.net) からユーザー プロファイルを読み込もうとします。これは実体として SMB ファイル共有として参照されるので、SMB は cifs/mystuff.file.core.windows.net の Kerberos チケットを探しに行くのです。</p><p>Azure AD 認証プロセスで、Windows にマッピング情報を与えているので、Windows は *.windows.net リソースのために Active Directory ドメインコントローラーに問い合わせるということはしません。その代わり、Kerberos スタックはクラウド TGT を realm マッピングと一緒にキャッシュに配置し、realm マッピングと Azure AD テナントの詳細情報の間で「KDC Proxy」マップを構成します。</p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works4.png" alt="Azure AD に TGS-REQ を送信する Kerberos">  </p><p>これにより、チケット要求に対して、Kerberos は cifs/mystuff.file.core.windows.net を参照し、*.windows.net は KERBEROS.MICROSOFTONLINE.COM にマッピングされ、その realm から <a href="https://login.microsoftonline.com/tenantid/kerberos">https://login.microsoftonline.com/tenantid/kerberos</a> にマッピングする KDC Proxy が出来上がることになります。</p><p><a href="https://docs.microsoft.com/ja-jp/openspecs/windows_protocols/ms-kkdcp/5bcebb8d-b747-4ee5-9453-428aec1c5c38?WT.mc_id=modinfra-54539-socuff">KDC Proxy protocol</a> は、インターネット上で Kerberos をやり取りする仕組みです。そして、Azure AD は Ticket Granting Service-Request (TGS-REQ) を受け取ることになります。  </p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works5.png" alt="Ticket Granting Service - 要求">  </p><p>次に Azure AD は:</p><ol><li>クラウド TGT と Azure AD のテナント ID が一致するか確認します。  </li><li>ユーザーが存在するかどうかを問い合わせます。  </li><li>要求されたサービス プリンシパル名 (Azure AD にアプリケーションとして登録された Azure Files リソース) を検索します。  </li><li>チケットを生成します。  </li><li>チケットを、そのサービス プリンシパル名に格納されている Azure Files ストレージ キーで暗号化します。  </li><li>そしてそれをすべて TGS-REP にまとめて返します。 </li></ol><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works6.png" alt="TGT 要求の送信と受信を行う際の Kerberos の動作">  </p><p>Kerberos スタックが TGT 応答 (TGS-REP) を取り戻すと、Kerberos スタックは:</p><ol><li>チケットを開封します。</li><li>アプリケーション リクエスト (AP-REQ) を生成し、SMB にそれを渡します。  </li><li>SMB プロトコルは AP-REQ をヘッダーに詰め込み、SMB Hello を Azure Files に送信します。  </li></ol><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works7.png" alt="AP-REQ と暗号化されたチケットを受信する際の SMB の動作">  </p><p>Azure Files は hello を受け取り、チケットを復号化 (ストレージ キーを使用) して完了です。FSLogix は、Azure File Share のユーザー プロファイルを読み込んで、Azure Virtual Desktop セッションをロードします。</p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works8.png" alt="SMB 経由で Azure File Share にアクセスする FSLogix の動作">  </p><p>SMB、Azure Files、AVD からすると、Kerberos チケットが実際に Active Directory を参照していないということは全くわかりません。</p><p>注: このサービスの現在のパブリック プレビューでは、オンプレミスの Active Directory にユーザーが存在し、Azure AD Connect を使用して Azure AD に同期されていることが必要です。Azure AD 上でのみ作成されたクラウド ユーザーの利用はまだサポートされていませんが、今後サポートされる予定です。</p><h2 id="Azure-Files-for-FSLogix-と-Azure-Virtual-Desktop-を導入する方法"><a href="#Azure-Files-for-FSLogix-と-Azure-Virtual-Desktop-を導入する方法" class="headerlink" title="Azure Files for FSLogix と Azure Virtual Desktop を導入する方法"></a>Azure Files for FSLogix と Azure Virtual Desktop を導入する方法</h2><p>Azure Files などの設定方法について、ステップごとに知りたい場合は、Dean Cefola のビデオをご覧ください。</p><p>(<a href="https://www.youtube.com/watch?v=suvDH-yNL88">https://www.youtube.com/watch?v=suvDH-yNL88</a>)</p><p>必要な PowerShell コマンドは、<a href="https://docs.microsoft.com/ja-jp/azure/virtual-desktop/create-profile-container-adds?WT.mc_id=modinfra-54539-socuff">Azure Files および Azure AD DS を使用してプロファイル コンテナーを作成する</a> をご覧ください。</p><p>図を追加し、素晴らしい技術的解説をさらに発展させる機会を与えてくれた Steve Syfus 氏に感謝します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2022 年 1 月 25 日に米国の ITOps Talk Blog で公開された &lt;a href=&quot;https://techcommunity.microsoft.com</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD 証明書ベース認証 パブリック プレビューのご案内</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/</id>
    <published>2022-02-22T21:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.209Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 2 月 14 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/azure-ad-certificate-based-authentication-now-in-public-preview/ba-p/2464390">Azure AD Certificate-Based Authentication now in Public Preview</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>本日、当社の商用および米国政府クラウドにおいて、Azure Active Directory 証明書ベース認証 (<strong>Azure AD CBA</strong>) がパブリック プレビューとなりましたことを発表でき、大変嬉しく思います。</p><p>2021 年 5 月、バイデン大統領は大統領令 14028 号 <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">国家のサイバー セキュリティの改善</a> を発表し、連邦政府に対して、職員、ビジネス パートナー、そしてベンダーに対するフィッシング耐性のある多要素認証 (MFA) を含むゼロ トラスト アーキテクチャを導入するよう求めました。</p><blockquote><p>「段階的な改善では、必要なセキュリティを確保できません。その代わりに、連邦政府は、アメリカの生活様式を支える重要な組織を守るため、大胆な改革と大規模な投資を行う必要があるのです。」<br>バイデン大統領、大統領令 14028 号</p></blockquote><p>当社は政府と連携した経験をもとに、PIV/CAC カードは連邦政府内で使用される最も一般的な認証方法であると理解しています。</p><p>すべてのお客様にとって重要なことですが、<strong>Azure AD に対して直接 X.509 証明書を使用して認証できる</strong> ことは、<strong>PIV / CAC カード</strong> を使用している連邦政府組織や、大統領令 14028 の要件に準拠しようとしている組織にとっても特に重要です。</p><p>以下では、当社 ID セキュリティ チームのプロダクト マネージャーである Vimala Ranganathan より、詳細を説明いたします。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/alex_a_simons">@Alex_A_Simons</a><br>Corporate Vice President Program Management<br>Microsoft Identity Division </p><hr><p>皆さん、こんにちは。</p><p>アイデンティティ PM チームの Vimala です。以下に、Azure AD CBA (Azure AD 証明書ベース認証) について説明させていただきます。</p><p>Azure AD CBA は、米国のサイバー セキュリティに関する大統領令へのコミットメントの一環として、政府機関のお客様が PIV / CAC カードを使用してフィッシング防止の MFA 認証を容易に満たすことができるよう支援します。Azure AD のユーザーは、スマート カードやデバイスの X.509 証明書を使用して、ブラウザやアプリケーションのサインインの際、Azure AD に対して直接認証することができます。</p><p>主なメリットは、以下のとおりです。</p><ul><li>フィッシングに強い証明書ベースの認証により、より高いセキュリティを実現 (ID 攻撃の大半はパスワードに関連している)</li><li>フィッシング耐性のある MFA に関する大統領令 14028 号の要件を容易に満たすことが可能</li><li>オンプレミスのフェデレーション基盤にかかるコストとリスクを排除</li><li>Azure AD でのきめ細かなコントロールによる、簡素化された管理体験を実現</li></ul><p>SAP 社は素晴らしいパートナー企業であり、Azure AD CBA のパブリック プレビューを実現する上で、重要なフィードバックを提供いただきました。</p><blockquote><p>「CBA は、SAP 製品の中核をなす歴史的なものです。証明書ベースの認証は 1999 年から SAP で使用しており、複数回にわたって移行および導入をしてきました。Azure AD にこれらの機能がネイティブに備わることで、長期的には AD FS を引退させることができ、Azure AD は我々が利用する最後のフェデレーション エンドポイントとなるのです。」<br>SAP 社 アイデンティティ アーキテクト Sven Frank 氏</p></blockquote><h2 id="Azure-AD-証明書ベース認証-Azure-AD-CBA-とは何か？"><a href="#Azure-AD-証明書ベース認証-Azure-AD-CBA-とは何か？" class="headerlink" title="Azure AD 証明書ベース認証 (Azure AD CBA) とは何か？"></a>Azure AD 証明書ベース認証 (Azure AD CBA) とは何か？</h2><p>ご存知のように、これまで Azure AD に対して X.509 証明書を使用する認証には、AD FS などの連携 ID プロバイダ (IdP) が必要でした。本日ご紹介する Azure AD CBA パブリック プレビューでは、お客様は連携プロバイダを必要とせず、Azure AD に対して直接認証することができるようになります。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/Image01_SimplifiedArchitecture.png" alt="図 1: 簡素化されたアーキテクチャ"></p><h2 id="証明書ベースの認証方式管理"><a href="#証明書ベースの認証方式管理" class="headerlink" title="証明書ベースの認証方式管理"></a>証明書ベースの認証方式管理</h2><p>下の図は、管理者が CBA を有効にする手順を示しています。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/Image02_MethodManagement.png"></p><p>詳細につきましては、こちらの公開情報をご覧ください: <a href="http://aka.ms/AADCBA">http://aka.ms/AADCBA</a> </p><h2 id="エンド-ユーザー体験"><a href="#エンド-ユーザー体験" class="headerlink" title="エンド ユーザー体験"></a>エンド ユーザー体験</h2><p>エンド ユーザーとして、UPN (User Principal Name) を入力すると、パスワード画面に「Sign in with a certificate」のリンクが表示されます。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/Image03_UserSignin.png" alt="図 2: 証明書を利用したサインイン"></p><p>正しいクライアント証明書を選択するよう促され、選択することでアプリケーションへの認証が完了します。</p><p>注: テナントで CBA が有効になっている場合、テナント内のすべてのユーザーのサインイン ページに「証明書を使用してサインインする」というリンクが表示されます。しかし、Azure AD に対して正常に認証できるのは CBA のスコープ内のユーザーのみで、それ以外のユーザーには失敗が表示されます。</p><h2 id="今後について"><a href="#今後について" class="headerlink" title="今後について"></a>今後について</h2><p>今後、Windows スマート カード ログオン、第二認証要素としての CBA 、信頼できる発行者リストの制限撤廃、証明書失効リスト (CRL) など、さらなる素晴らしい機能の開発に取り組んでいます。</p><p>ご意見がございましたら、ぜひ遠慮なく <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure AD コミュニティ</a> までお寄せください。</p><p>大統領令 14028 号の詳細については、<a href="https://www.microsoft.com/en-us/federal/CyberEO.aspx">こちら</a> をご確認ください。</p><p>Vimala</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 2 月 14 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>クロス テナントのアクセス設定でよりセキュアなコラボレーションを実現</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/</id>
    <published>2022-02-14T00:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.289Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 2 月 7 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/collaborate-more-securely-with-new-cross-tenant-access-settings/ba-p/2147077">Collaborate more securely with new cross-tenant access settings</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>先日の <a href="https://jpazureid.github.io/blog/azure-active-directory/external-identities-b2c-supports-authenticator-apps-and-new-data/">External Identities のアップデート</a> に続き、外部コラボレーションのためのクロス テナントのアクセス設定がパブリック プレビューで利用可能となったことをお知らせいたします。</p><p>クロス テナントのアクセス設定により、組織内のユーザーが外部の Azure AD 組織のメンバーとどのように共同作業を行うかを制御することが可能となります。組織、ユーザー、グループおよびアプリケーションごとにきめ細かなインバウンドおよびアウトバウンドのアクセス制御の設定が可能になりました。また、これらの設定により、多要素認証 (MFA)、デバイス準拠、ハイブリッド Azure AD 参加デバイスなど、外部の Azure AD 組織からのセキュリティ クレームを信頼できるようになります。</p><p>外部との連携に関しては、お客様から以下のようなご意見をいただいていました。</p><ol><li>承認された外部ユーザーのみがアプリとリソースにアクセスでき、組織の承認されたユーザーのみが外部アプリとリソースにアクセスできるようにしたい。 </li><li>パートナーからの MFA クレームを信頼し、ホーム ディレクトリ (外部ユーザーがメンバーとして所属するディレクトリ) で MFA を実行した外部ユーザーが、リソース ディレクトリ (外部ユーザーがゲストして招待されたディレクトリ) で再び MFA を要求されないようにしたい。</li><li>ユーザーが外部からアクセスしているアプリと、外部ユーザーが組織内でアクセスしているアプリを把握したい。</li></ol><p>このようなご意見を反映させ、以下のような機能を開発しました。それぞれの詳細についてご紹介いたします。</p><h2 id="クロス-テナントのアクセス設定手順"><a href="#クロス-テナントのアクセス設定手順" class="headerlink" title="クロス テナントのアクセス設定手順"></a>クロス テナントのアクセス設定手順</h2><h3 id="ユーザーとコラボレーションできる外部ユーザーと組織をコントロールする"><a href="#ユーザーとコラボレーションできる外部ユーザーと組織をコントロールする" class="headerlink" title="ユーザーとコラボレーションできる外部ユーザーと組織をコントロールする"></a>ユーザーとコラボレーションできる外部ユーザーと組織をコントロールする</h3><p><strong>インバウンドの設定</strong> では、アプリやリソースにアクセスできる外部ユーザーを制御することができます。すべての外部ユーザーとのコラボレーションを許可することも、特定の組織の特定のユーザーやグループのみにアクセスを許可するように制限することもできます。また、これらのユーザーがアクセスできる組織内のアプリを指定することもできます。 クロス テナントのアクセス設定についての詳細は、<a href="https://docs.microsoft.com/en-us/azure/active-directory/external-identities/cross-tenant-access-overview">公開情報</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/image01.png"></p><h3 id="ユーザーがコラボレーションを行える外部組織を管理する"><a href="#ユーザーがコラボレーションを行える外部組織を管理する" class="headerlink" title="ユーザーがコラボレーションを行える外部組織を管理する"></a>ユーザーがコラボレーションを行える外部組織を管理する</h3><p><strong>アウトバウンドの設定</strong> では、ユーザーがコラボレーションできる外部組織を制御することができます。ユーザーがすべての外部組織とコラボレーションできるようにしたり、特定のユーザーやグループが、特定の外部組織の特定のアプリにアクセスすることだけを許可したりすることができます。</p><p><img src="/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/image02.png"></p><h3 id="Azure-AD-の外部組織からのセキュリティ-クレームを-MFA-とデバイスのために信頼する"><a href="#Azure-AD-の外部組織からのセキュリティ-クレームを-MFA-とデバイスのために信頼する" class="headerlink" title="Azure AD の外部組織からのセキュリティ クレームを MFA とデバイスのために信頼する"></a>Azure AD の外部組織からのセキュリティ クレームを MFA とデバイスのために信頼する</h3><p><strong>インバウンドの信頼設定</strong> では、外部ユーザーがホーム ディレクトリで実行する MFA を信頼することができます。これは、外部ユーザーがホーム ディレクトリとリソース ディレクトリの両方で複数回 MFA を実行しなければならないという、お客様からいただいたフィードバックに対応するものです。外部ユーザーがホーム ディレクトリで実行した MFA を信頼することで、外部ユーザーがリソース ディレクトリで MFA を完了する必要がなくなり、シームレスな認証体験を実現できます。また、組織で発生する MFA の費用も削減できます。</p><p>さらに、インバウンドの信頼設定により、ホーム ディレクトリにて準拠したデバイス、または Azure AD に参加したハイブリッド デバイスを信頼することができます。以前は、外部ユーザーに対して、準拠デバイスまたはハイブリッド Azure AD 参加デバイスを要求するなど、デバイス ベースの条件付きアクセス ポリシーを実施することはできませんでした。インバウンドの信頼設定を使用して外部の Azure AD 組織からのデバイス クレームを受け入れることで、外部ユーザーが準拠デバイスまたはハイブリッド Azure AD 参加デバイスを使用することを要求することにより、アプリとリソースへのアクセスを保護できるようになりました。 インバウンドの信頼設定が条件付きアクセスでどのように機能するかについては、<a href="https://docs.microsoft.com/en-us/azure/active-directory/external-identities/authentication-conditional-access">こちら</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/image03.png"></p><h3 id="組織のリソースに誰がアクセスしているかを把握する"><a href="#組織のリソースに誰がアクセスしているかを把握する" class="headerlink" title="組織のリソースに誰がアクセスしているかを把握する"></a>組織のリソースに誰がアクセスしているかを把握する</h3><p>サインイン ログから、ユーザーがアクセスしている外部アプリや、リソースにアクセスしている外部ユーザーを確認できます。詳細は <a href="https://docs.microsoft.com/en-us/azure/active-directory/external-identities/cross-tenant-access-overview#identify-inbound-and-outbound-sign-ins">公開情報</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/image04.png"></p><h2 id="まずはどのようにコラボレーションを実現するかを決めましょう"><a href="#まずはどのようにコラボレーションを実現するかを決めましょう" class="headerlink" title="まずはどのようにコラボレーションを実現するかを決めましょう"></a>まずはどのようにコラボレーションを実現するかを決めましょう</h2><p>クロス テナントのアクセス設定をカスタマイズする前に、どの外部組織がアプリやリソースにアクセスする必要があるのか、またどのユーザーが外部アプリやリソースにアクセスする必要があるのかを確認し、進行中のコラボレーションを間違って止めてしまわないようにすることが重要です。この <a href="https://aka.ms/cross-tenant-signins-workbook">ワークブック</a> を使用して、組織がどのように外部組織とコラボレーションしているかを理解し、ビジネスへの影響を回避することをお勧めします。</p><h2 id="お客様からの声をご紹介"><a href="#お客様からの声をご紹介" class="headerlink" title="お客様からの声をご紹介"></a>お客様からの声をご紹介</h2><p>Bupa 社は、全世界で 3,100 万人以上の顧客を持つ国際的な健康保険およびヘルスケア グループです。この機能をテストしてきた中で以下のような感想をいただきました。 </p><p>“弊社の大規模で複雑な組織においても、この機能を利用することでより活発なコラボレーションが実現し、何より重要なセキュリティを強化するための基礎を築くことができました。” </p><p>さらに、最も規制の厳しい業界のお客様においてもオープンなコラボレーションを今回可能にしたことで、このようなフィードバックをいただきました。 </p><p>“クロス テナントのアクセス設定によりリスクを大幅に削減し、セキュリティを向上させることができました。さらに、外部テナントへのアクセスやコラボレーションのニーズにおいても、より良いビジネス サポートが可能になりました。セキュリティ部門に加えビジネスの面でも、そして重要なことですが監査官や規制当局からも高い満足を得ています。” </p><p>皆様からのご意見をお待ちしております。これらの新機能に関するご意見は、Azure フォーラムまたは Twitter で <a href="https://twitter.com/azuread">@AzureAD</a> 宛てにお寄せください。</p><p>Robin Goldstein<br>Twitter: <a href="https://twitter.com/RobinGo_MS">@RobinGo_MS</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 2 月 7 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>シークレットなしで異なるソフトウェア ワークロードから Azure リソースにアクセス</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/access-azure-resources-from-software-workload-in-different/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/access-azure-resources-from-software-workload-in-different/</id>
    <published>2022-02-08T19:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.185Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 1 月 31 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/access-azure-resources-from-software-workload-in-different/ba-p/2464394">Access Azure resources from software workload in different environments, no secrets necessary</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>誰もが体感しているように、世界全体がデジタル化され、あらゆるものがクラウドに接続されるようになってきています。これは、皆さんの組織がこれまで以上に多くのソフトウェアを作成および使用し、そのほとんどがどこかのクラウドでワークロードとして稼働していることを意味します。</p><p>通常、これらのソフトウェア ワークロードは Azure Storage や Key Vault、Microsoft Graph からアクセスできる文書や電子メールなどクラウド上のリソースにアクセスする必要があります。そしてこれらのソフトウェア ワークロードは、ユーザーと同じように認証する必要もあります。しかしこの認証が開発者や DevOps、管理者にとって大きな課題となるのです。それは認証を行うためにシークレットを扱う必要があるからです。これらのシークレットは、安全に保管され、頻繁にローテーションされなければなりません。特に、他のリソースにアクセスする必要のあるソフトウェア ワークロードの数が増えているため、多くの組織でシークレットの管理が難しくなっています。 </p><p>そこで私たちは、認証におけるシークレットの必要性を最小限に抑えるために、Azure AD にワークロード ID フェデレーションという新しいパブリック プレビューの機能を追加しました。これは、ソフトウェア ワークロードが Azure のマネージド ID を使用できない環境で動作している場合に特に有用です。この機能により、Azure や Microsoft Graph など Azure AD で保護されたリソースに、シークレットなしでアクセスできるようになります。他の ID プロバイダーからソフトウェア ワークロードに発行されたトークンを信頼するように Azure AD を構成することができます。ソフトウェア ワークロードは、これらのトークンを使用して Azure AD からトークンを取得し、Azure と Graph リソースにアクセスできます。</p><p>以下に、ワークロード ID フェデレーションの機能を利用できるシナリオをいくつか紹介します。 </p><ul><li><strong>GitHub Actions ワークフローで Azure による CI/CD を実現</strong>: GitHub リポジトリに Azure AD シークレットを保存するのではなく、GitHub トークンを使用してサービスを認証し、Azure にデプロイすることが可能です。(詳細は <a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-azure">GitHub のドキュメント</a> をご覧ください) </li><li><strong>Kubernetes クラスタで動作するサービス</strong>: Kubernetes クラスタによりサービス アカウントに発行されるトークンを使用して、Azure リソースにアクセスすることができます。<a href="https://github.com/Azure/azure-workload-identity">Azure AD workload identity for Kubernetes</a> は、この機能の利用を案内しているオープンソース プロジェクトで、実行場所にかかわらずこの機能を利用いただけます。</li><li><strong>ワークロード ID に SPIFFE/SPIRE を使用しているサービス</strong>: ソフトウェア ワークロードで利用している ID に SPIFFE/SPIRE を使用している場合、SPIFFE トークンを使用して Azure リソースにアクセスすることができます。 </li><li><strong>Google Cloud Platform で動作するサービス</strong>: Google サービス アカウントに発行された ID トークンを使用すると、GCP (Google Cloud Platform) で動作するソフトウェア ワークロードは追加のシークレットなしで Azure リソースにアクセスできます。</li></ul><p>私のチーム メンバーである <a href="https://twitter.com/udayxhegde">Uday Hegde</a> のブログにて、それぞれのシナリオについて説明しています。 </p><ul><li><a href="https://blog.identitydigest.com/azuread-federate-github-actions/">GitHub Actions CI/CD to Azure</a></li><li><a href="https://blog.identitydigest.com/azuread-federate-k8s/">Services running in Kubernetes clusters</a></li><li><a href="https://blog.identitydigest.com/azuread-federate-spiffe/">Services using SPIFFE/SPIRE for their workload identities</a></li><li><a href="https://blog.identitydigest.com/azuread-federate-gcp/">Services running in Google Cloud Platform</a> </li></ul><p>私たちは今後も、このようなシークレットの必要ない認証を実現できるシナリオを拡大していく予定です。</p><p>Azure AD ワークロード ID フェデレーションについては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/workload-identity-federation">こちらの公開情報</a> で詳しく説明していますので併せてご覧ください。</p><p>いつも通り、ご意見やご感想をお待ちしております。以下のコメント欄、または <a href="(https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789)">Azure AD フィードバック フォーラム</a> でご意見をお聞かせください。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/Alex_A_Simons">@alex_a_simons</a>)<br>Corporate Vice President Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 1 月 31 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>AD FS 2019 以降でセカンダリ AD FS をホスト名のみで構成すると WAP の構成および信頼関係の更新に失敗する</title>
    <link href="https://jpazureid.github.io/blog/active-directory-federation-service/adfs-wap-federation-renew/"/>
    <id>https://jpazureid.github.io/blog/active-directory-federation-service/adfs-wap-federation-renew/</id>
    <published>2022-02-04T16:00:00.000Z</published>
    <updated>2022-03-05T11:48:28.929Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの山口です。</p><p>AD FS ファームを Windows Server 2019 以降 のサーバー (複数) で構成している環境において、WAP サーバーの新規構成および信頼関係の更新に失敗する事象について紹介します。<br>この事象は次の 2 つの条件を満たした場合に発生します。</p><ol><li>AD FS ファームのセカンダリ サーバーを構成する際、プライマリ サーバーを FQDN ではなくホスト名のみで構成している</li><li>WAP を新規構成する際に発生する通信、あるいは信頼関係の更新処理に伴う通信がセカンダリ AD FS に対して行われる場合</li></ol><p>本事象の影響を受ける環境か確認する方法、発生する事象の詳細と具体的な対処方法は以下のとおりです。</p><h2 id="影響を受ける構成かどうかを確認する方法"><a href="#影響を受ける構成かどうかを確認する方法" class="headerlink" title="影響を受ける構成かどうかを確認する方法"></a>影響を受ける構成かどうかを確認する方法</h2><p>AD FS 2019 以降でセカンダリ サーバーが存在する場合、セカンダリ サーバーで以下の Powershell コマンドレットを実行します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-AdfsSyncProperties</span></span><br></pre></td></tr></table></figure><p>以下のように、PrimaryComputerName がホスト名のみで構成されている場合に該当します。</p><p><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-001.jpg"></p><p>以下のように、FQDN で構成されている場合には該当いたしません。</p><p><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-002.jpg"></p><h2 id="発生する事象"><a href="#発生する事象" class="headerlink" title="発生する事象"></a>発生する事象</h2><p>以下のような事象が発生します。</p><ol><li>AD FS 2019 以降の環境で WAP の新規構成に失敗する。</li><li>AD FS 2019 以降の環境に OS をアップグレードした後に、WAP と AD FS 間の信頼関係の更新に失敗するようになり、(結果として) WAP 経由の認証に失敗するようになる。</li></ol><p>上記 1. については以下画面ショットのように Web アプリケーション プロキシ構成ウィザードより新規構成を試行した結果、<strong>フェデレーション サービスとの信頼関係の構築中にエラーが発生しました。エラー: Bad Request</strong> と表示され WAP の構成に失敗している場合に本事象に該当する可能性があります。</p><p>※エラー内容が Bad Request と表示されている場合に本事象に該当している可能性が高いです。</p><p><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-003.jpg"></p><p>上記 2. については WAP サーバーのイベント ビューアー「アプリケーションとサービス ログ」→「AD FS」→「Admin」ログ内に、下記画面ショットのように ID 394 が定期的に記録されている場合に場合に該当する可能性があります。</p><p>※エラー内容が Bad Request と表示されている場合に本事象に該当している可能性が高いです。</p><p><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-004.jpg"></p><h2 id="なぜ発生するのか"><a href="#なぜ発生するのか" class="headerlink" title="なぜ発生するのか"></a>なぜ発生するのか</h2><p>AD FS 2019 以降の Windows Server OS より、AD FS は所定のエンドポイントで HTTP リクエストを受信した際に、明確に FQDN を指定しないとエラーを返す (HTTP 400 エラーを返す) 実装が追加されたためです。</p><h2 id="対処方法について"><a href="#対処方法について" class="headerlink" title="対処方法について"></a>対処方法について</h2><p>セカンダリ AD FS サーバー上で以下の PowerShell コマンドレットを実行し、プライマリ AD FS サーバーをホスト名ではなく FQDN に変更します。</p><ol><li>セカンダリ AD FS サーバー上で管理者として PowerShell を起動します。</li><li>以下の PowerShell コマンドレットを実行し、「PrimaryComputerName」がプライマリ AD FS サーバーのホスト名のみになっていることを確認します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-AdfsSyncProperties</span></span><br></pre></td></tr></table></figure><p>画面ショット例<br><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-005.jpg"></p><ol start="3"><li>以下の PowerShell コマンドレットを実行し、「PrimaryComputerName」をプライマリ AD FS サーバーの FQDN に変更します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-AdfsSyncProperties</span> <span class="literal">-Role</span> SecondaryComputer <span class="literal">-PrimaryComputerName</span> &lt;プライマリ AD FS サーバーの FQDN&gt;</span><br><span class="line"></span><br><span class="line">(例)</span><br><span class="line"><span class="built_in">Set-AdfsSyncProperties</span> <span class="literal">-Role</span> SecondaryComputer <span class="literal">-PrimaryComputerName</span> ADFS<span class="literal">-008</span>.shyamag.work</span><br></pre></td></tr></table></figure><ol start="4"><li>以下の PowerShell コマンドレットを実行し、「PrimaryComputerName」がプライマリ AD FS サーバーの FQDN に変更されていることを確認します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-AdfsSyncProperties</span></span><br></pre></td></tr></table></figure><p>画面ショット例<br><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-006.jpg"></p><p>WAP サーバーを新規に構成ができない、もしくは信頼関係が切れている場合 (WAP 経由の認証ができない場合) は、上記の作業実施後に WAP を再構築します。また、信頼関係が切れていない場合 (WAP 経由の認証ができている場合) は、作業実施後に WAP サーバー上の AD FS サービス (Active Directory フェデレーション サービス) を再起動することで正常に WAP と AD FS 間の信頼環境を更新できるようになります。</p><h3 id="Q-AD-FS-2016-や-AD-FS-3-0-Windows-Server-2012-R2-の環境では影響は出ないのか。"><a href="#Q-AD-FS-2016-や-AD-FS-3-0-Windows-Server-2012-R2-の環境では影響は出ないのか。" class="headerlink" title="Q. AD FS 2016 や AD FS 3.0 (Windows Server 2012 R2) の環境では影響は出ないのか。"></a>Q. AD FS 2016 や AD FS 3.0 (Windows Server 2012 R2) の環境では影響は出ないのか。</h3><p>A. はい、影響を受けません。</p><h3 id="Q-AD-FS-間の構成情報の同期に影響は出ないのか。"><a href="#Q-AD-FS-間の構成情報の同期に影響は出ないのか。" class="headerlink" title="Q. AD FS 間の構成情報の同期に影響は出ないのか。"></a>Q. AD FS 間の構成情報の同期に影響は出ないのか。</h3><p>A. AD FS 間の同期については影響を受けません。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの山口です。&lt;/p&gt;
&lt;p&gt;AD FS ファームを Windows Server 2019 以降 のサーバー (複数) で構成している環境において、WAP サーバーの新規構成および信頼関係の更新に失敗する事象について</summary>
      
    
    
    
    
    <category term="AD FS" scheme="https://jpazureid.github.io/blog/tags/AD-FS/"/>
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>「要求が調整されています」エラーの原因と対処策について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/howto-deal-with-throttling/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/howto-deal-with-throttling/</id>
    <published>2022-02-02T15:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.401Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。<br>今回は、サインイン ログや監査ログを大量にダウンロードしようとした際に発生する、 “要求が調整されます” というエラー メッセージの原因と対策についてご案内します。</p><h2 id="事象について"><a href="#事象について" class="headerlink" title="事象について"></a>事象について</h2><p>Azure AD のサインイン ログや監査ログをダウンロードしようとした際に、しばらくの間ダウンロード中の画面が表示された後、エラーになってしまう事象です。<br>同時に、下記のように “要求が調整されます” や “サーバーに対する要求が調整されています。” とのメッセージが表示されます。  </p><p><img src="/blog/azure-active-directory/howto-deal-with-throttling/howto-deal-with-throttling1.png"></p><h2 id="なぜメッセージが表示されてしまうのか"><a href="#なぜメッセージが表示されてしまうのか" class="headerlink" title="なぜメッセージが表示されてしまうのか"></a>なぜメッセージが表示されてしまうのか</h2><p>発生しているエラーは、一般的には多くの Graph API リクエストを送付したことによって発生するエラーです。  </p><p>サインイン ログや監査ログは、 Graph API を使用してログを収集します。<br>Graph API には大量の要求が行われた際、要求調整のため、しばらくの間リクエストを待つようリクエスト元に返す “スロットリング” という機能が用意されています。<br>Azure は、多くの企業様がご利用いただくパブリック クラウドです。 1 つのテナントで発生した大量の要求により、ほかのテナントの動作に影響が出ないよう、大量の要求には制限がかかるような動作となっています。  </p><p>“要求が調整されています” のメッセージが表示される場合、このスロットリングの影響でダウンロードに失敗していることが推測されます。<br>スロットリングはリクエスト数が増えることで発生するため、たとえば 1 ヶ月などの長い期間でログを取得しようとした場合、ログの数が多くスロットリングに抵触する可能性があります。  </p><h2 id="どのように対処すればよいか（暫定策）"><a href="#どのように対処すればよいか（暫定策）" class="headerlink" title="どのように対処すればよいか（暫定策）"></a>どのように対処すればよいか（暫定策）</h2><p>Azure ポータルからのダウンロードの要求とスロットリングの関連性を示した具体的なしきい値は公開されておりませんが、基本的にはダウンロード対象となるログの対象日時を小さくする、その他の要素でフィルターを行うなどの対応を実施する必要があります。</p><p>たとえば 1.2 週間ずつログをダウンロードするなど、ダウンロードの対象期間を短く設定したうえでのダウンロードをまずはご検討ください。<br>フィルターは、 Azure ポータルからログをダウンロードする前に、サインイン ログの画面から設定いただけます。<br>たとえば、下記の [許可された時刻] のフィルターをご利用いただくと、時間に基づいたフィルター設定を行うことが可能です。  </p><p><img src="/blog/azure-active-directory/howto-deal-with-throttling/howto-deal-with-throttling2.png"></p><p>なお、 お客様のご利用状況によっては、24 時間以内のログのみをダウンロードしてもエラーになってしまう場合があります。<br>この場合は、ユーザーやアプリケーションをはじめとするその他のフィルターを活用いただき、一度にダウンロードするログの件数を減らしたうえでダウンロードを実施ください。</p><h2 id="どのように対処すればよいか（恒久策）"><a href="#どのように対処すればよいか（恒久策）" class="headerlink" title="どのように対処すればよいか（恒久策）"></a>どのように対処すればよいか（恒久策）</h2><p>定期的にログを収集されたい場合には、 Log Analytics や Azure Storage にサインイン ログを転送する手法もございます。<br>この方法であれば Graph API は用いていないため、スロットリングに抵触することなくログを収集できます。<br>Azure AD のサインイン・監査ログの保存期限（最大 30 日）を超えてログをお客様の環境に保管できるメリットもあります。<br>加えて、Log Analytics に転送した場合は、 Log Analytics のクエリを使って、特定のログを絞り込むなどの操作も可能です。  </p><p>別途サブスクリプションの用意などが必要とはなりますため、コスト面などの調整が必要なものと存じておりますが、下記公開情報に記載の方法も併せてご検討ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/quickstart-azure-monitor-route-logs-to-storage-account">ストレージ アカウントへのアーカイブ方法</a><br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics">Log Analytics と Azure AD ログの連携方法</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;br&gt;今回は、サインイン ログや監査ログを大量にダウンロードしようとした際に発生する、 “要求が調整されます” というエラー メッセージの原因と対策についてご案内します。&lt;/p&gt;
&lt;h2 id=&quot;事象について&quot;&gt;&lt;a hr</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Signin Logs" scheme="https://jpazureid.github.io/blog/tags/Signin-Logs/"/>
    
    <category term="Audit Logs" scheme="https://jpazureid.github.io/blog/tags/Audit-Logs/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD における SAML 署名証明書を更新する</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/how-to-update-samlsigningcertificate/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/how-to-update-samlsigningcertificate/</id>
    <published>2022-02-02T08:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.397Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！ Azure &amp; Identity サポート チームの三浦 大です。</p><p>Azure AD (IDP) とアプリケーション (SP) を、SAML 連携させた (させたい) といったお客様もいらっしゃるかと思います。<br>今回は、Azure AD (IDP) とアプリケーション (SP) を SAML 連携した際に利用する、SAML 署名証明書についてご紹介いたします。<br>更新手順についても記載しておりますので、今後 SAML 署名証明書の更新を検討しているお客様もご一読いただければと思います！</p><p>SAML は、アプリケーションとのシングルサインオンを可能とする便利なフレームワークですが、<br>SAML 連携した際には、SAML 署名証明書を管理いただく必要がでてきます。</p><p>Azure AD において、具体的にどういった場面で SAML 署名証明書が利用されるかというと、Azure AD がアプリケーションに対して SAML レスポンスを返す際です。<br>Azure AD は、SAML レスポンスに SAML 署名証明書を利用して署名をします。<br>アプリケーションは、受け取った SAML レスポンスを検証し、問題がなければ、信頼している IdP である Azure AD から送られていることが証明され、アプリケーションへのアクセスを許可する動作となります。<br>以下シーケンスでいうところの、5 から 6 の処理となります。</p><p><img src="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/media/single-sign-on-saml-protocol/active-directory-saml-single-sign-on-workflow.png"></p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/single-sign-on-saml-protocol">シングル サインオンの SAML プロトコル | Microsoft Docs</a></li></ul><p>以上が、SAML 署名証明書が利用されるシナリオの概要となります。<br>それでは、実際の SAML 署名証明書を確認してみましょう。<br>Azure AD が利用する SAML 署名証明書は、以下の画面で確認することが可能です。</p><p>[Azure ポータル] - [Azure Active Directory] - [エンタープライズアプリケーション] - [&lt;ご利用の SAML アプリケーション&gt;] - [シングルサインオン]<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/Certificate-View.png"></p><p>右上にある “編集” をクリックすることで、証明書の一覧を確認することもできます。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-View.png"></p><p>“状態” が “アクティブ” である SAML 署名証明書が、現在署名に利用されている証明書です。<br>また、画像からも確認できるように、有効期限があることがわかります。<br>有効期限がきれると、”状態” が “期限切れ” と表示されます。<br>有効期限が切れた場合、アプリケーションへアクセスできなくなる可能性がございますので、事前に更新いただく必要がございます。</p><h1 id="2-SAML-署名証明書を更新する"><a href="#2-SAML-署名証明書を更新する" class="headerlink" title="2. SAML 署名証明書を更新する"></a>2. SAML 署名証明書を更新する</h1><p>以下では SAML 署名証明書を更新するための手順をご紹介します。</p><h3 id="1-Azure-AD-に新しい証明書を追加します"><a href="#1-Azure-AD-に新しい証明書を追加します" class="headerlink" title="(1) Azure AD に新しい証明書を追加します"></a>(1) Azure AD に新しい証明書を追加します</h3><p>[Azure ポータル] – [Azure Active Directory] – [エンタープライズ アプリケーション] – [&lt;ご利用の SAML アプリケーション&gt;] – [シングル サインオン] - [SAML 署名証明書] の [編集] をクリックし、[新しい証明書] を選択することで新しい証明書が追加されます。<br>ここで追加した証明書のデータはフェデレーション メタデータ XML に追加されます。<br>この作業の結果、新しく追加した証明書は、非アクティブとして追加され、いきなり新しい証明書を利用した署名が行われるわけではないため、この 1 の手順によるダウンタイム (利用中のアプリケーションへの影響) はありませんのでご安心ください。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-Create.png"></p><h3 id="2-アプリケーションに新しい-SAML-署名証明書をインポートする"><a href="#2-アプリケーションに新しい-SAML-署名証明書をインポートする" class="headerlink" title="(2) アプリケーションに新しい SAML 署名証明書をインポートする"></a>(2) アプリケーションに新しい SAML 署名証明書をインポートする</h3><p>具体的にはアプリケーション側の実装となるため、事前にアプリケーションベンダー様へご確認いただく必要がございます。<br>例として、アプリケーション側の SAML 署名証明書 を更新する方法は、以下のいずれかが一般的かと存じます。  </p><p>(i) Azure AD のフェデレーションメタデータ XML より SAML 署名証明書をインポートする<br>(ii) Azure AD より SAML 署名証明書をダウンロードしてインポートする  </p><p>ここで注意いただきたいのが、<br>アプリケーションにSAML 署名証明書をインポートするにあたり、複数の証明書がインポートできるかという点です。<br>理由として、SAML 署名証明書を更新する際に、ダウンタイム (利用中のアプリケーションへの影響) が発生するか否かに影響があるためです。<br>管理者にとっては、 SAML 署名証明書の更新においても、ダウンタイムが発生しないことが理想だと思います。<br>アプリケーション側で複数の SAML 署名証明書をインポート、その情報を反映でき、新旧どちらの SAML 署名証明書で署名されても検証ができるアプリケーションであれば、ダウンタイムは発生しないと考えられます。<br>しかし、アプリケーション側で複数の SAML 署名証明書をインポートできない場合は、新しい SAML 署名証明書へ更新するタイミングでダウンタイムが発生することが想定されるため、場合によっては、事前に利用ユーザーへの周知が必要です。<br>繰り返しとなりますが、どういった実装になっているか、手順やダウンタイムが発生するかという点については、事前にアプリケーションベンダーへ確認ください。  </p><h3 id="3-Azure-AD-側のアクティブな証明書を更新する"><a href="#3-Azure-AD-側のアクティブな証明書を更新する" class="headerlink" title="(3) Azure AD 側のアクティブな証明書を更新する"></a>(3) Azure AD 側のアクティブな証明書を更新する</h3><p>新しい SAML 署名証明書をアプリケーションにインポートできたら、Azure AD が署名に利用する SAML 署名証明書を切り替えます。<br>新しい証明書で署名するには、Azure ポータルで新しい証明書を右クリックし、[証明書をアクティブにする] を選択します。<br>これにより、新しい証明書がアクティブになり、古い証明書が非アクティブになります。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-Active.png"></p><h3 id="4-SAML-認証ができるかを確認する"><a href="#4-SAML-認証ができるかを確認する" class="headerlink" title="(4) SAML 認証ができるかを確認する"></a>(4) SAML 認証ができるかを確認する</h3><p>アプリケーションに問題なく SAML 認証ができるかをご確認ください。<br>問題なく成功する場合は、SAML 署名証明書の更新完了です。<br>古い SAML 署名証明書は不要ですので、削除しても問題ありません。<br>もしも、SAML 認証に失敗するようになったという場合は、<br>我々 Microsoft サポート窓口にて問題解決のご支援をしますので、お気兼ねなく、お問い合わせを発行いただけますと幸いです。</p><h1 id="3-SAML-署名証明書についてよくある質問"><a href="#3-SAML-署名証明書についてよくある質問" class="headerlink" title="3. SAML 署名証明書についてよくある質問"></a>3. SAML 署名証明書についてよくある質問</h1><h3 id="Q-SAML-署名証明書の有効期限が切れたけど、認証できるんだけど。。"><a href="#Q-SAML-署名証明書の有効期限が切れたけど、認証できるんだけど。。" class="headerlink" title="Q: SAML 署名証明書の有効期限が切れたけど、認証できるんだけど。。"></a><span style="color: blue; ">Q:</span> SAML 署名証明書の有効期限が切れたけど、認証できるんだけど。。</h3><p><span style="color: red; ">A:</span> アプリケーションに依存して有効期限が切れても認証できる可能性があります。<br>現時点での Azure AD の実装として、SAML 署名証明書の有効期限が経過した場合でも、その証明書を利用した署名を行い、 SAML レスポンスを返す動作となります。ご利用のアプリケーション側で、 署名の検証の際に証明書の有効期限をチェックしていない場合などは、引き続きアクセスできます。<br>ただし、アプリケーション次第でもありますし、有効期限が経過する前に SAML 署名証明書の更新を実施するよう、ご検討ください。  </p><h3 id="Q-SAML-リクエストをアプリケーション側で署名しているが、Azure-AD-で検証用の証明書は管理しているのか？"><a href="#Q-SAML-リクエストをアプリケーション側で署名しているが、Azure-AD-で検証用の証明書は管理しているのか？" class="headerlink" title="Q: SAML リクエストをアプリケーション側で署名しているが、Azure AD で検証用の証明書は管理しているのか？"></a><span style="color: blue; ">Q:</span> SAML リクエストをアプリケーション側で署名しているが、Azure AD で検証用の証明書は管理しているのか？</h3><p><span style="color: red; ">A:</span> 管理していません。<br>Azure AD は SAML リクエスト時の署名は検証せずに無視をする動作となります。<br>仮にアプリケーション側で証明書の更新が発生しても、Azure AD ではアプリケーション側からの SAML リクエストの署名を検証するための証明書を管理していないため、Azure AD 側での更新は考慮する必要はありません。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/single-sign-on-saml-protocol#signature">署名 | Microsoft Docs</a></li></ul><h3 id="Q-SAML-署名証明書の期間は？長くできるの？"><a href="#Q-SAML-署名証明書の期間は？長くできるの？" class="headerlink" title="Q: SAML 署名証明書の期間は？長くできるの？"></a><span style="color: blue; ">Q:</span> SAML 署名証明書の期間は？長くできるの？</h3><p><span style="color: red; ">A:</span> Azure AD が発行する SAML 署名証明書は、最大で 3 年の有効期限です。<br>3 年以上の有効期限を持った証明書は作成することができず、期限を延長するといったこともできません。<br>もしも、3 年以上の有効期限をもった証明書を登録したい場合は、独自に発行した自己署名証明書などを利用ください。<br>例えば、以下の手順では 10 年の有効期限の証明書を使用可能です。  </p><p>(1) 管理者権限で PowerShell を起動します。<br>(2) 以下のコマンドを順に実行します ($dnsName はどのような値でも結構です)。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$dnsName</span>=<span class="string">&quot;contoso.onmicrosoft.com&quot;</span></span><br><span class="line"><span class="variable">$lifetime</span>=<span class="built_in">Get-Date</span></span><br><span class="line"><span class="built_in">New-SelfSignedCertificate</span> <span class="literal">-Subject</span> *.<span class="variable">$dnsName</span> <span class="literal">-NotAfter</span> <span class="variable">$lifetime</span>.AddYears(<span class="number">10</span>) <span class="literal">-KeyUsage</span> DigitalSignature, KeyEncipherment <span class="literal">-DnsName</span> *.<span class="variable">$dnsName</span>, <span class="variable">$dnsName</span></span><br></pre></td></tr></table></figure><p>(3) 以下のように表示されることを確認します (Thumbprint は環境によって異なる値となります)。  </p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">PSParentPath: Microsoft.PowerShell.Security\Certificate::LocalMachine\MY</span><br><span class="line"></span><br><span class="line">Thumbprint                                Subject</span><br><span class="line">----------                                -------</span><br><span class="line"><span class="number">832</span>A24298E691642AB05A6056A6EF6C7EF8BC531  CN=*.contoso.onmicrosoft.com</span><br></pre></td></tr></table></figure><p>(4) 証明書を PFX ファイルとしてエクスポートするために以下のコマンドを実行します。Thumbprint には 3 の結果、password には任意の文字列を指定ください。  </p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$mypwd</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="literal">-String</span> <span class="string">&quot;P@ssw0rd&quot;</span> <span class="literal">-Force</span> <span class="literal">-AsPlainText</span></span><br><span class="line"><span class="built_in">Get-ChildItem</span> <span class="literal">-Path</span> cert:\localMachine\my\<span class="number">832</span>A24298E691642AB05A6056A6EF6C7EF8BC531 | <span class="built_in">Export-PfxCertificate</span> <span class="literal">-FilePath</span> C:\mypfx.pfx <span class="literal">-Password</span> <span class="variable">$mypwd</span></span><br></pre></td></tr></table></figure><p>(5) C:\mypfx.pfx としてエクスポートされますので、これを SAML 署名証明書の構成画面よりインポートします。  </p><h3 id="Q-“署名オプション”-や-“署名アルゴリズム”-はなにを設定すればいいの？"><a href="#Q-“署名オプション”-や-“署名アルゴリズム”-はなにを設定すればいいの？" class="headerlink" title="Q: “署名オプション” や “署名アルゴリズム” はなにを設定すればいいの？"></a><span style="color: blue; ">Q:</span> “署名オプション” や “署名アルゴリズム” はなにを設定すればいいの？</h3><p><span style="color: red; ">A:</span> アプリケーションの実装に依存するため、アプリケーションベンダーへご確認ください。<br>“署名オプション” は、Azure AD が返す SAML レスポンスのどこに署名するかを決める設定となります。<br>“署名アルゴリズム” は、署名に用いるアルゴリズムを決める設定となります。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-Signature.png"></p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/certificate-signing-options">SAML トークンの詳細な証明書署名オプション | Microsoft Docs</a></li></ul><h3 id="Q-SAML-署名証明書がきれる前に通知できますか？"><a href="#Q-SAML-署名証明書がきれる前に通知できますか？" class="headerlink" title="Q: SAML 署名証明書がきれる前に通知できますか？"></a><span style="color: blue; ">Q:</span> SAML 署名証明書がきれる前に通知できますか？</h3><p><span style="color: red; ">A:</span> 可能です。<br>SAML 証明書の有効期限が切れる 60 日前、30 日前、7 日前に、登録したメールアドレスへ、通知メールが送信されます。<br>メールアドレスは複数登録することも可能です。<br>メールアドレスの登録は以下の画面で実施できます。  </p><p>[Azure ポータル] - [Azure Active Directory] - [エンタープライズ アプリケーション] - [&lt;ご利用の SAML アプリケーション&gt;] - [シングルサインオン] - [SAML 署名証明書 の “編集” をクリック]<br>該当のメールアドレスを登録して “保存” をクリック<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-Notification.png"></p><p>送信されるメールのサンプルはこちらになります。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/NotificationSample.png"></p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/manage-certificates-for-federated-single-sign-on#add-email-notification-addresses-for-certificate-expiration">証明書の有効期限のメール通知アドレスの追加 | Microsoft Docs</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは！ Azure &amp;amp; Identity サポート チームの三浦 大です。&lt;/p&gt;
&lt;p&gt;Azure AD (IDP) とアプリケーション (SP) を、SAML 連携させた (させたい) といったお客様もいらっしゃるかと思います。&lt;br&gt;今回は、Azure </summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Application" scheme="https://jpazureid.github.io/blog/tags/Application/"/>
    
  </entry>
  
  <entry>
    <title>アプリでゼロ トラスト対応を実現する 2 - 最小限の特権で設計する</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/achieving-zero-trust-readiness-in-your-apps-2-designing-for-least-privilege/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/achieving-zero-trust-readiness-in-your-apps-2-designing-for-least-privilege/</id>
    <published>2022-01-24T00:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.189Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの竜です。</p><p>本記事は、2022 年 1 月 18 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/achieving-zero-trust-readiness-in-your-apps-2-designing-for/ba-p/2959986">Achieving Zero Trust readiness in your apps #2: Designing for Least Privilege</a> を意訳したものになります。</p><hr><p>こんにちは、Jeff Sakowicz です。Microsoft Identity チームで、Application Platform Security の Principal Program Management Lead をしています。私たちのチームの目標は、安全で信頼性が高く、発展的なアプリのエコシステムを作っていくことです。この目標を達成する一環として、アプリがゼロ トラストのセキュリティ モデルをサポートできるようにすることがあげられます。</p><p>前回に続き、今回は「なぜ開発者にとってゼロ トラストが重要なのか」についての二つ目の記事となります。<a href="https://jpazureid.github.io/blog/azure-active-directory/Achieving-ZeroTrust-readiness-in-your-apps1-Why-it-matters/">前回</a> は、<a href="https://www.microsoft.com/ja-jp/security/business/zero-trust?rtc=1">ゼロ トラスト</a> の原則およびゼロ トラストが ID とアクセス管理にどのように適用されるかをご紹介しました。今回は、Microsoft の ID プラットフォームにおいて、「<strong>最小限の特権アクセスの原則</strong>を使用してアプリケーションを設計する方法」についてご説明します。</p><h2 id="なぜ最小特権アクセスの使用にこだわる必要があるのでしょうか？"><a href="#なぜ最小特権アクセスの使用にこだわる必要があるのでしょうか？" class="headerlink" title="なぜ最小特権アクセスの使用にこだわる必要があるのでしょうか？"></a>なぜ最小特権アクセスの使用にこだわる必要があるのでしょうか？</h2><p>端的に言うと、アプリケーションの許可を制限することで、攻撃された場合に影響を受ける範囲を減らし、アプリを利用する顧客を増やすことができるからます。実際のところ、IT 管理者はアプリから要求される権限を確認する際やアプリに権限を付与するかどうかを決定する際に、以前より厳しく精査を行うようになっています。たくさんの権限を要求するアプリを作成した場合、アプリが承認される可能性が低くなり、時にはアプリの利用が完全に拒否される場合もあります。</p><h2 id="過剰な特権とは何でしょうか？過剰な特権が与えられているアプリとはどんなものでしょうか？"><a href="#過剰な特権とは何でしょうか？過剰な特権が与えられているアプリとはどんなものでしょうか？" class="headerlink" title="過剰な特権とは何でしょうか？過剰な特権が与えられているアプリとはどんなものでしょうか？"></a>過剰な特権とは何でしょうか？過剰な特権が与えられているアプリとはどんなものでしょうか？</h2><p>ある主体が必要以上の特権を要求し、場合によってはそのアクセス許可が付与されることを、私たちは「過剰な特権」と呼んでいます。この記事では、Microsoft Graph API を呼び出すクライアント アプリのシナリオを例に、Microsoft ID プラットフォーム上で使用される OAuth 2.0 のアクセス許可において「過剰な権限が与えられているアプリ」に特に着目して説明します。この記事に記載されている原則は、他のアクセス許可のモデルや API にも適用可能なため、より詳細については今後の記事でも説明していく予定です。</p><p>過剰な特権は、アプリが「<strong>未使用の</strong>」または「<strong>削減可能な</strong>」アクセス許可を要求し、そのアクセス許可を付与された場合に発生します。</p><ol><li>「<strong>未使用のアクセス許可</strong>」とは、目的の作業には全く必要のないアクセス許可を指します。例えば、カレンダー アプリが、”Files.ReadWrite.All” アクセス許可を取得しているにもかかわらず、Files API を利用していない場合は、<strong>未使用の</strong>アクセス許可が存在することになります。</li><li>「<strong>削減可能なアクセス許可</strong>」とは、必要な作業を実行するためのアクセスを満たす、より低い特権を持つアクセス許可を指します。例えば、サインインしたユーザーの OneDrive からファイルを読み込む必要があるが、新しいファイルの作成や既存のファイルの変更は必要としないアプリを考えてみましょう。このアプリが “Files.ReadWrite.All” アクセス許可を要求し付与された場合は、アプリは削減可能なアクセス許可を持つことになります。このアプリは 、”Files.ReadWrite.All” ではなく、”Files.Read.All” を要求することが適切です。</li></ol><h2 id="過剰な特権が付与されているアプリに対応するうえでの最終的な目標は何でしょうか？"><a href="#過剰な特権が付与されているアプリに対応するうえでの最終的な目標は何でしょうか？" class="headerlink" title="過剰な特権が付与されているアプリに対応するうえでの最終的な目標は何でしょうか？"></a>過剰な特権が付与されているアプリに対応するうえでの最終的な目標は何でしょうか？</h2><p>MMicrosoft ID チームは、過剰な特権を付与されているアプリへの対応を進めるために、3 つの主要な目標を掲げています。</p><ol><li><strong>開発者</strong>が、過剰なアクセス許可を要求せず、スムーズに採用されるような信頼できるアプリを構築できるように支援します。不必要な権限を要求すると、アプリが利用される環境において、ユーザーおよび IT 部門、さらには組織で設定された <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/configure-user-consent?tabs=azure-portal">アプリの同意ポリシー</a> の間で不和が生じます。</li><li><strong>IT 管理者やその他の意思決定者</strong>が過剰な特権を持つアプリを制限できるよう、組織内で必要な最小限のアクセス許可を特定する方法や、最小限のアクセス許可を要求および付与する方法について支援します。</li><li>侵害の範囲を拡大したり、組織内での別マシンへのさらなる乗っ取を防止したりするような特権を<strong>攻撃者</strong>が取得できないように防止します。</li></ol><h2 id="アプリを確実に最小特権化するにはどうすれば良いのでしょうか？"><a href="#アプリを確実に最小特権化するにはどうすれば良いのでしょうか？" class="headerlink" title="アプリを確実に最小特権化するにはどうすれば良いのでしょうか？"></a>アプリを確実に最小特権化するにはどうすれば良いのでしょうか？</h2><p>ここでは、開発者と IT 管理者が、「アプリケーションの最小特権の原則を遵守すること」を考える際に、念頭に置くべき 3 つのベスト プラクティスをざっくりとご紹介します。</p><ol><li>未使用のアクセス許可や削減可能なアクセス許可を避け、過剰な特権を<strong>防止</strong>しましょう。アプリケーションが API の呼び出しに必要とするアクセス許可を確認し、お客様のシナリオを実現するために必要なものだけを要求しましょう。</li><li>お手持ちのアプリに対して既に付与されたアクセス許可を定期的に<strong>監査</strong>し、アクセス許可を削減もしくは削除できないか確認しましょう。つまり、IT 管理者においてはテナント内のアプリに付与されたアクセス許可を監査し、開発者はアプリが要求しているアクセス許可を確認しましょう。</li><li>アプリを<strong>アップデート</strong>して、未使用のアクセス許可や削減可能なアクセス許可を要求しないようにし、また以前付与されたアクセス許可の中でも不要になったものを取り消しましょう。</li></ol><p>マイクロソフトは、このプロセスを支援するツールを用意しています。例えば、<a href="https://developer.microsoft.com/ja-jp/graph/graph-explorer">Graph Explorer</a> を使用することで、お客様のシナリオを実現するためにどのような Microsoft Graph API の呼び出しが必要か確認いただけます。その後、Microsoft Graph の<a href="https://docs.microsoft.com/ja-jp/graph/permissions-reference">アクセス許可のリファレンス</a> を使用し、Microsoft Graph の最小限の特権から最大限の特権の中で、適切なアクセス許可を見つけることができます。</p><p>具体的な手順については、こちらの資料をご参照ください: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/secure-least-privileged-access">最小限の特権の原則でセキュリティを高める</a></p><h2 id="ゼロ-トラストへ対応した開発を始める方法"><a href="#ゼロ-トラストへ対応した開発を始める方法" class="headerlink" title="ゼロ トラストへ対応した開発を始める方法"></a>ゼロ トラストへ対応した開発を始める方法</h2><p>さらに詳しく知りたい方は、<a href="https://docs.microsoft.com/security/zero-trust/">Zero Trust Guidance Center</a> に公開された開発者向けの新しいガイダンスをご覧ください。このガイダンスには、Zero Trust に対応したアプリケーションを開発するための <a href="https://docs.microsoft.com/en-us/security/zero-trust/identity-developer">新しい開発および統合リソース</a> が含まれています。</p><p>詳細については、こちらからダウンロードできる開発者向けホワイトペーパーをご覧ください: <a href="https://aka.ms/ztdev">Zero Trust for the Microsoft Identity developer</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの竜です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 1 月 18 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommu</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>External Identities (B2C) が Authenticator アプリに対応するとともにデータ保存場所の価格更新が発表されました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/external-identities-b2c-supports-authenticator-apps-and-new-data/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/external-identities-b2c-supports-authenticator-apps-and-new-data/</id>
    <published>2022-01-22T23:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.341Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2022 年 1 月 20 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/external-identities-b2c-supports-authenticator-apps-and-new-data/ba-p/2147079">External Identities B2C supports Authenticator apps, and new data residency pricing</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>明けましておめでとうございます。新しい年になりましたので、新しい機能を発表したいと思います。本日は、B2C ユーザー向けの時間ベースのワン タイム パスコード (時間に基づいて生成される OTP) による多要素認証 (MFA) のパブリック プレビューと、Azure AD B2C ディレクトリのデータ保存場所のサポートに関する重要な変更など、Azure AD External Identities の 2 つのアップデートについてお知らせします。</p><h2 id="時間ベースの-OTP-で-B2C-ユーザー向けの-MFA-を強化"><a href="#時間ベースの-OTP-で-B2C-ユーザー向けの-MFA-を強化" class="headerlink" title="時間ベースの OTP で B2C ユーザー向けの MFA を強化"></a>時間ベースの OTP で B2C ユーザー向けの MFA を強化</h2><p>詐欺やセキュリティ攻撃の増加により、消費者のアカウントをより安全な MFA の方法で保護することが重要となっています。B2C のユーザー フローに認証アプリを介した時間ベースの OTP を組み込むことで、既存の電子メールや電話の要素に比べて高いレベルのセキュリティを提供でき、電話料金の発生も抑えることが可能となります。<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">アプリベースの MFA がメールや電話の MFA だけよりも安全だといえる</a> 理由については、Alex Weinert の説明をご覧ください。</p><p>お使いのユーザー アカウント用の時間ベースの OTP は、どの認証アプリケーションでも設定できます。弊社では Microsoft Authenticator を利用して時間ベースの OTP を設定することをお勧めしています。Microsoft Authenticator では認証状態の確認を暗号化された双方向通信にて行っており、さらに様々な利用の流れや設定に対応することで、ユーザーが自らセキュリティを高められるようにしています。</p><p><img src="/blog/azure-active-directory/external-identities-b2c-supports-authenticator-apps-and-new-data/microsoft-authenticator-app-images-lined-up-option.jpg"></p><p>この B2C ユーザー フローでは、Contoso という会社の顧客が Microsoft Authenticator アプリケーションで時間ベースの OTP を使用して認証を完了するよう促されています。</p><p>Azure AD B2C で時間ベースの OTP を設定する方法については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory-b2c/multi-factor-authentication?pivots=b2c-user-flow#verification-methods">こちらのドキュメント</a> をお読みください。</p><h2 id="データ保存場所に関する価格の更新"><a href="#データ保存場所に関する価格の更新" class="headerlink" title="データ保存場所に関する価格の更新"></a>データ保存場所に関する価格の更新</h2><p>弊社では、お客様がデータを管理でき、地域のデータ保存場所の要件に準拠することが非常に重要であることを認識しております。このビジネス クリティカルな要望に対応する最初のステップとして、今年初めに <a href="https://docs.microsoft.com/ja-jp/azure/active-directory-b2c/data-residency">Azure AD B2C のデータをオーストラリアで保持する機能の一般提供</a> を発表しました。この機能に対する需要の増加に対応するため、2022 年半ばより、オーストラリアやその他の特定の国/地域向けにデータ保存場所を設定した既存および新規のお客様には、月間アクティブ ユーザー (MAU) あたり 0.02 ドルの追加料金が発生するようになります。</p><p><img src="/blog/azure-active-directory/external-identities-b2c-supports-authenticator-apps-and-new-data/b2c-go-local-australia.jpg"></p><p>お客様からのフィードバックに基づき、お客様がデータ保存の要件を満たすために必要な国や地域を選択できるよう、データ保存場所の提供を拡大し続けてまいります。</p><p>これらのアップデートに関するご意見は、Azure フォーラムまたは Twitter で <a href="https://twitter.com/azuread">@AzureAD</a> のタグを付けてお寄せください。</p><p>Robin Goldstein<br>Twitter: <a href="https://twitter.com/RobinGo_MS">@RobinGo_MS</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 1 月 20 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD における継続的なアクセス評価の一般提供を開始しました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/continuous-access-evaluation-in-azure-ad-is-now-generally/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/continuous-access-evaluation-in-azure-ad-is-now-generally/</id>
    <published>2022-01-22T16:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.317Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 1 月 10 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/continuous-access-evaluation-in-azure-ad-is-now-generally/ba-p/2464398">Continuous Access Evaluation in Azure AD is now generally available!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>Azure AD のゼロ トラスト セッション管理ポートフォリオの一部として、継続的アクセス評価 (Continuous Access Evaluation、以下 CAE) の一般提供 (GA) を発表できることを嬉しく思います。</p><p>CAE は、以下を含めたアカウントのライフサイクルにおいて発生するイベントとポリシーにリアルタイムに対応します。 </p><ul><li>アカウントの取り消し</li><li>アカウントの無効化/削除</li><li>パスワードの変更</li><li>ユーザーの場所の変更</li><li>ユーザー リスクの増大</li></ul><p>上記のようなイベントを受け取ると、アプリのセッションは直ちに中断され、ユーザーは Azure AD にリダイレクトされ、再認証やポリシーの再評価が行われます。CAE では、ゼロ トラストの原則 (Verify Explicitly: 明示的な確認と Assume Breach: 攻撃者が既に自社の IT 環境に潜伏していると想定) を基盤に、ゼロ トラスト認証セッション管理という新しい概念を導入しました。ゼロ トラストのアプローチでは、認証セッションの持続時間は事前に定義された期間ではなく、セッションの完全性に依存します。この仕組みは、<a href="https://openid.net/wg/sse/">Shared Signals and Events</a> と呼ばれる業界の取り組みと一致しており、私たちはこのグループの中で、一般公開に耐える継続的アクセスの実装を行った最初の企業であることを誇りに思います。</p><p>CAE の一般公開に伴い、すべてのテナントにおいて本機能を自動で有効にしました。Azure AD Premium 1 ライセンスをご利用のお客様は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-conditional-access-session#customize-continuous-access-evaluation">条件付きアクセスのセッション ブレード</a> で設定を変更したり、CAE を無効にすることができます。</p><p><img src="/blog/azure-active-directory/continuous-access-evaluation-in-azure-ad-is-now-generally/Image01.png"></p><p>この一般提供により、ポリシーのリアルタイムな適用が可能となり、これによりセッションの持続時間を安全に延長できるため、より安全で耐障害性の高い運用が可能になります。万が一、Azure AD が停止した場合でも、CAE セッションを使用しているユーザーは、影響を受けることなく継続して使用できます。</p><blockquote><p>CAE のおかげで、Exchange Online や SharePoint Online のような重要なサービスで、セッションの取り消しやユーザーの再認証を待つ必要がなくなりました。ユーザー ID でセキュリティ インシデントが発生しても、トークンを即座に失効させることができるので安心感があります。さらに、CAE のデフォルトのセッション持続期間が長いことも、特に障害の可能性に対する耐性を高めるという観点で歓迎すべき利点です。 – BRIDGEWATER 社</p></blockquote><p>CAE は最も人気のあるプレビュー機能の 1 つで、すでに数千のお客様によって数百万人のユーザーに対して導入され成功を収めています。CAE の詳細については、現在 CAE をサポートしている <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation#critical-event-evaluation">アプリのリスト</a> も含め、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">こちら</a> でご覧いただけます。</p><p>いつものように、皆様のご意見や提案をお聞かせください。コメントをお寄せいただくか、<a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">AzureADFeedback</a> までお気軽にご連絡ください。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/Alex_A_Simons">@alex_a_simons</a>)<br>Corporate Vice President Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 1 月 10 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Decentralized ID を使用したソリューション開発にご参加ください</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/join-us-to-build-solutions-using-decentralized-identities/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/join-us-to-build-solutions-using-decentralized-identities/</id>
    <published>2022-01-22T00:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.453Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの高田です。</p><p>本記事は、2022 年 1 月 10 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/join-us-to-build-solutions-using-decentralized-identities/ba-p/2810649">Join us to build solutions using Decentralized Identities</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>サイバー セキュリティ攻撃は、日々、組織や顧客データを危険にさらしており、企業はデータの管理方法とそれに伴うリスクの度合いについてこれまでとは異なる考えを持つよう迫られています。ユーザーは、電子化された取引がシームレスかつ安全に行われ、同時にプライバシーも保護されることを必要としています。より透明で安全なデジタル ID 体験を実現するには、標準ベースの <a href="https://aka.ms/ownyouridentity">Decntralized ID</a> (DID) システムで既存のクラウド ID システムを補強していく必要があります。この新しいシステムにより、ユーザーや組織が自分のデータをより詳細に管理し、自身の ID を直接証明できるようにし、アプリケーション、デバイス、サービス プロバイダに高度な信頼性と安全性を提供します。</p><p>Decentralized ID の核となるのは、<a href="https://aka.ms/verifyonce">検証可能な資格情報</a> 技術です。これは、信頼できるプロバイダーが、大学の学生証や医療機関の健康記録など、検証済みの ID をユーザーに発行することを可能にします。ユーザーが資格情報を証明する必要がある時は、検証済み ID を共有することで、要求者はそれが適切に署名され最新であることを自動的に確認することができます。それぞれの検証済み ID は設計上変更不可であり、迅速に共有することができ、個人データそのものではなく証明のみを共有することができるため、身元確認のためのプロセスがより簡単、迅速、かつ安全になります。これは Win-Win の関係であり、世界中の組織がすでに様々なユース ケースでこれらのソリューションを試験的に導入しています。</p><p>1 月中は、このエキサイティングな新技術について知っていただくために、コーディングのライブ ストリーム、ブログ、YouTube ビデオなど、一連のイベントを開催し、1 万ドル以上の賞金をかけた素晴らしいハッカソンを最後に開催する予定です。エンジニア、サポート、プロダクト マネジメントの各チームが技術サポートを提供し、参加者のみなさんを支援します。ハッカソンに必要なのは、ノート パソコンと想像力、そして簡単なコーディングをして検証可能な資格情報を発行したり検証したりするソリューションを作りたいという気持ちだけです。ただ事前に必要なものがいくつかありますので、当日に必要なものが揃っているかどうか、ご確認ください。</p><p>1 月に開催予定のイベントの一覧:</p><table><thead><tr><th>Date</th><th></th></tr></thead><tbody><tr><td>01/13</td><td><a href="https://425.show/twitch">Twitch ストリーム</a></td></tr><tr><td>01/19</td><td><a href="https://425.show/twitch">Twitch ストリーム - DID の紹介 (つづき)</a>]</td></tr><tr><td>01/19</td><td>YouTube のビデオ プレイリスト - DID の紹介</td></tr><tr><td>01/24</td><td><a href="https://425.show/did-space">Twitter Spaces - Decentralized ID の紹介</a></td></tr><tr><td>01/25</td><td><a href="https://www.twitch.tv/425Show">Twitch Stream - 検証可能な資格情報を使用したアプリの開発</a></td></tr><tr><td>01/25</td><td><a href="https://425.show/twitch">Twitch Stream - DID 基盤の設定</a></td></tr><tr><td>01/27</td><td><a href="https://425.show/did-hackathon">ハッカソン: DID で何かスゴいものを作ろう</a></td></tr></tbody></table><p>まずは、QR コードをスキャンするか、以下のリンク (<a href="https://425.show/blogreader">https://425.show/blogreader</a>) をクリックして、最初の認証済み資格情報を発行ください。</p><p><img src="/blog/azure-active-directory/join-us-to-build-solutions-using-decentralized-identities/qr-code.png"></p><p>標準規格や技術コンポーネント、コードの成果物をオープンソース化し、誰もがアクセスできるようにすることで、DID のエコシステムが成長し、繁栄すると信じています。今後の活動に心からワクワクしています。このエキサイティングなテクノロジーを使ってソリューションを構築したい個人や組織と提携することを楽しみにしています。</p><p>Decentralized ID Hackathon への参加申し込みは <a href="https://microsoft-did.devpost.com/">こちら</a> からどうぞ。また、<a href="https://425.show/twitch">Twitch</a> でフォローいただくか、<a href="https://425.show/discord">Discord</a> チャンネルに参加して、エキスパートとつながり、コラボレーションしていただくことも可能です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの高田です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 1 月 10 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD の新機能により ID プロビジョニングをよりシンプルに</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/simplify-your-identity-provisioning-with-these-new-azure-ad/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/simplify-your-identity-provisioning-with-these-new-azure-ad/</id>
    <published>2022-01-01T00:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.581Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 12 月 13 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/simplify-your-identity-provisioning-with-these-new-azure-ad/ba-p/2466922">Simplify your identity provisioning with these new Azure AD capabilities</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>リモートワークの発展と導入が進む中、強固な ID とガバナンスの制御が ITの拡張性と柔軟なユーザー体験にとって重要です。本日、このようなご要望に対応するために、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/">Azure Active Directory</a> (Azure AD) の新機能とベスト プラクティスをご紹介します。これらのアップデートにより、Azure AD Connect クラウド同期を構成している状況でのクラウドからのパスワード ライトバックの実行、オンプレミス アプリケーションへのプロビジョニング、SCIM プロビジョニング エンドポイントの検証などが可能になります。</p><h2 id="オンプレミスとクラウドを問わずパスワードのリセットが可能に"><a href="#オンプレミスとクラウドを問わずパスワードのリセットが可能に" class="headerlink" title="オンプレミスとクラウドを問わずパスワードのリセットが可能に"></a>オンプレミスとクラウドを問わずパスワードのリセットが可能に</h2><p>パスワード ライトバックにより、オンプレミスから同期しているユーザーがクラウド上でパスワードの変更を開始すると、ユーザーのオンプレミス <a href="https://docs.microsoft.com/ja-jp/azure/active-directory-domain-services/overview">Active Directory Domain Services (AD DS)</a> 環境にリアルタイムにパスワードが書き戻されます。これにより、ユーザーは複数のパスワードの管理に悩まされることなく、クラウドとオンプレミスのアプリケーションをシームレスに行き来することができます。また、パスワードがどこで更新されても、クラウドとオンプレミスの間で同期状態を維持することが可能です。</p><p>現在パブリック プレビュー中の <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-enable-cloud-sync-sspr-writeback">Azure AD Connect クラウド同期のパスワード ライトバック</a> を用いることで、従来の Azure AD Connect からは到達できないドメインに存在するユーザーをパスワード ライトバックの対象とすることが可能となります。組織は、複数のネットワーク的に分断されたドメインから単一の Azure AD テナントにユーザーを同期し、Azure AD からこれらのユーザーのパスワードをリセットすることができます。</p><p><img src="/blog/azure-active-directory/simplify-your-identity-provisioning-with-these-new-azure-ad/on-premesis-integration.png"></p><h2 id="クラウドおよびオンプレミスのアプリケーションへのプロビジョニングをよりシンプルに"><a href="#クラウドおよびオンプレミスのアプリケーションへのプロビジョニングをよりシンプルに" class="headerlink" title="クラウドおよびオンプレミスのアプリケーションへのプロビジョニングをよりシンプルに"></a>クラウドおよびオンプレミスのアプリケーションへのプロビジョニングをよりシンプルに</h2><p>Microsoft Ignite において、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/on-premises-scim-provisioning">SCIM</a>、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/tutorial-ecma-sql-connector">SQL</a>、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/on-premises-ldap-connector-configure">LDAP</a> をサポートするオンプレミスアプリケーションへのプロビジョニングに関し、Azure AD でパブリック プレビューが利用可能となったことを <a href="https://jpazureid.github.io/blog/azure-active-directory/identity-at-ignite-strengthen-resilience-with-identity/">発表</a> しました。お客様は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/saas-apps/mondaycom-provisioning-tutorial">monday.com</a>、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/saas-apps/miro-provisioning-tutorial">Miro</a>、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/saas-apps/asana-provisioning-tutorial">Asana</a> などの人気のある SaaS アプリケーションと同じ方法で、オンプレミス アプリケーションへのプロビジョニングを管理することが可能です。さらにこの発表に加えて、今回、OpenLDAP などのサードパーティの LDAP ディレクトリにユーザーをプロビジョニングする機能を追加いたしました。</p><p><img src="/blog/azure-active-directory/simplify-your-identity-provisioning-with-these-new-azure-ad/azure-ad.png"></p><h2 id="SCIM-規格に準拠したプロビジョニング-エンドポイントの構築とテストをよりシンプルに"><a href="#SCIM-規格に準拠したプロビジョニング-エンドポイントの構築とテストをよりシンプルに" class="headerlink" title="SCIM 規格に準拠したプロビジョニング エンドポイントの構築とテストをよりシンプルに"></a>SCIM 規格に準拠したプロビジョニング エンドポイントの構築とテストをよりシンプルに</h2><p>SCIM 検証ツールが限定でプレビュー開始となりました。これにより、パートナーや顧客は、エンドポイントが Azure AD SCIM クライアントと互換性があるかどうかを検証でき、Azure AD アプリケーション ギャラリーへの登録に要する時間を短縮することができます。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/use-scim-to-provision-users-and-groups">手順</a> に従い新しいアプリケーションの構築が完了しましたら、こちらの <a href="https://forms.office.com/pages/responsepage.aspx?id=v4j5cvGGr0GRqy180BHbR7dZme7gPidCseyJdx2X-31UNUlLU05EVTg0MjBKNU1CV1ZDVkJZU0pVWC4u">リンク</a> よりプレビューへの招待をリクエストできます。</p><p><img src="/blog/azure-active-directory/simplify-your-identity-provisioning-with-these-new-azure-ad/scim-results.png"></p><h2 id="Azure-AD-Connect-同期を最新バージョンへアップグレードして今後に備える"><a href="#Azure-AD-Connect-同期を最新バージョンへアップグレードして今後に備える" class="headerlink" title="Azure AD Connect 同期を最新バージョンへアップグレードして今後に備える"></a>Azure AD Connect 同期を最新バージョンへアップグレードして今後に備える</h2><p>Azure AD Connect 同期のレガシー バージョン (v1.x) は、SQL Server 2012 や ADAL などのコンポーネントに依存していますが、これらは来年に廃止される予定です。そのため、すべてのお客様は同期処理のサポートが中断されないよう、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/reference-connect-version-history">Azure AD Connect sync v2.0</a> へアップグレードいただくか、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/cloud-sync/what-is-cloud-sync">Azure AD Connect クラウド同期</a> への切り替えをご検討いただく必要がございます。Azure AD Connect 同期 v1.x のバージョンは、2022 年 8 月 30 日をもちまして廃止されます。</p><p>IT に関する計画の予測が容易となるよう、弊社では Azure AD Connect 同期のバージョンについて一貫した廃止サイクルを確立しています。今後は、新バージョンがリリースされてから 18 カ月後に各バージョンを廃止する予定です。</p><h2 id="プロビジョニング-ロジックに日付の比較を使用する"><a href="#プロビジョニング-ロジックに日付の比較を使用する" class="headerlink" title="プロビジョニング ロジックに日付の比較を使用する"></a>プロビジョニング ロジックに日付の比較を使用する</h2><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/functions-for-customizing-application-data">属性マッピング</a> を用いることにより、対象のシステムに書き込む前にデータを制御および変換することができます。皆様からのフィードバックに基づき、新しい組み込み日付関数 <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/functions-for-customizing-application-data#now">Now()</a>, <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/functions-for-customizing-application-data#dateadd">DateAdd()</a>, <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/functions-for-customizing-application-data#datediff">DateDiff()</a> を追加し、日付を比較したり、日付時刻の値に基づくきめ細かい属性プロビジョニングを定義できるようにいたしました。ユーザーのプロビジョニング フローの他の関数とネストしたり組み合わせることで、以下のようなシナリオを実装できます。</p><ul><li>ユーザー タイプに基づいて、SaaS アプリケーションまたはオンプレミス アプリケーションのユーザー アカウントの有効期限を、 現在のプロビジョニング時刻から “X” 日後に設定する。</li><li>現在の日付と人事的な採用日の間隔の差を求め、それをアカウントの有効化/データフロー ロジックの決定に使用する。</li></ul><p>いつも通り、皆様のご意見をお聞かせください。コメントをお寄せいただくか、<a href="https://feedback.azure.com/d365community">aka.ms/AzureADFeedback</a> までお気軽にご連絡ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 12 月 13 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure ポータル UX における Azure AD Graph 権限のサインアップのサポート終了</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/end-of-support-for-azure-ad-graph-permission-sign-up-through/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/end-of-support-for-azure-ad-graph-permission-sign-up-through/</id>
    <published>2021-12-26T00:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.337Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 12 月 8 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/end-of-support-for-azure-ad-graph-permission-sign-up-through/ba-p/2464404">End of support for Azure AD Graph permission sign up through portal UX</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>昨年、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">Azure AD Graph API と ADAL (Azure Active Directory Authentication Library) の廃止</a> を発表しました。廃止プロセスの一環として、8 月に <a href="https://twitter.com/Microsoft365Dev/status/1432810426442649603?s=20">こちら</a> でお知らせしたように、 Azure ポータル画面からアプリ登録する際の以下の Azure AD Graph API の権限設定を無効化しました。</p><p><img src="/blog/azure-active-directory/end-of-support-for-azure-ad-graph-permission-sign-up-through/legacy_apis.png"></p><p>この変更の目的は、Azure AD Graph を使用するよう設定される新規アプリケーションの数を減らし、新規アプリケーションを Azure AD Graph API で構成するようなレガシーなプロセスが残っていないか確認することにあります。Azure AD Graph の権限を持つ既存のアプリケーションは、API が廃止されるまで引き続き動作し、Azure AD Graph の権限の表示、同意、設定、削除は引き続き Azure ポータルを使用して行うことが可能です。</p><p>アプリケーションの移行作業中に、まだアプリケーションに Azure AD Graph 権限を追加する必要がある場合は、次のいずれかの方法をご利用ください。</p><ul><li>Azure ポータルを使用して、組織が使用する API を検索します。</li><li>Azure ポータルでアプリケーション 仕様書を更新します。</li><li>Microsoft Graph <a href="https://docs.microsoft.com/graph/api/resources/application?view=graph-rest-1.0">application API</a> を使用し、<a href="https://docs.microsoft.com/graph/api/resources/requiredresourceaccess?view=graph-rest-1.0">requiredResourceAccess</a> プロパティを更新します。</li><li>Microsoft Graph PowerShell <a href="https://docs.microsoft.com/powershell/module/microsoft.graph.applications/update-mgapplication?view=graph-powershell-1.0">Update-MgApplication</a> コマンドレットを使用して RequiredResourceAccess オブジェクトを更新します。</li></ul><p>詳細なガイダンスは、<a href="https://docs.microsoft.com/graph/migrate-azure-ad-graph-faq#i-need-to-add-new-azure-ad-graph-permissions-to-my-app-but-i-cant-select-azure-ad-graph-as-a-required-permission-for-my-app-registration-how-can-i-add-the-azure-ad-graph-permissions">移行 FAQ</a> を参照ください。</p><p>上記にて紹介しました権限設定の方法は、Azure AD Graph API が廃止されるまでご利用可能です。アプリケーションを移行した後は、アプリケーションから Azure AD Graph 権限を削除し、Microsoft Graph 権限のみを保持することをお勧めします。弊社ではお客様がアプリケーションを <a href="https://docs.microsoft.com/graph/overview">Microsoft Graph API</a> に移行するための取り組みを支援させていただきますので、移行過程でお力になれることがございましたらお知らせください。</p><p>Alex Simons (Twitter: <a href="http://twitter.com/alex_a_simons">@Alex_A_Simons</a>)<br>Corporate Vice President of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 12 月 8 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD カスタム セキュリティ属性の紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-azuread-custom-security-attributes/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-azuread-custom-security-attributes/</id>
    <published>2021-12-26T00:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.441Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。</p><p>本記事は、2021 年 12 月 1 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/introducing-azure-ad-custom-security-attributes/ba-p/2147068">Introducing Azure AD custom security attributes</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>今回の Microsoft Azure Active Directory (Azure AD) のカスタム セキュリティ属性と、ABAC (Attribute Based Access Control / 属性ベースのアクセス制御) 条件におけるユーザー属性のパブリック プレビューは、前回の Azure Storage における ABAC 条件の <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/introducing-attribute-based-access-control-abac-in-azure/ba-p/2147069">パブリック プレビュー</a> を踏まえたものです。Azure AD のカスタム セキュリティ属性 (以下、カスタム属性) は、Azure AD で定義できるキーと値のペアで、ユーザーやサービス プリンシパル (エンタープライズ アプリケーション)、マネージド ID などの Azure AD オブジェクトに割り当てることができます。カスタム属性を使用すると、ユーザーのコスト センターやエンタープライズ アプリケーションを所有するビジネス ユニットなどのビジネス固有の情報を追加し、特定のユーザーがそれらの属性を管理できるようになります。ユーザー属性は、Azure ロール割り当ての ABAC 条件で使用することができ、リソース属性だけの場合よりも、さらにきめ細かいアクセス制御が可能になります。Azure AD のカスタム セキュリティ属性の利用には、Azure AD Premium ライセンスが必要です。</p><p>カスタム属性機能は、Azure AD での属性の管理や Azure ロール割り当てでの ABAC 条件について寄せられたフィードバックにもとづいて開発されました。</p><ul><li>いくつかのシナリオでは、ユーザーに関する機密情報を Azure AD に保存し、許可されたユーザーのみがこの情報を読み取ったり管理したりできるようにする必要があります。たとえば、各従業員の職位を保存し、人事部の特定のユーザーのみがその属性を読み取り、管理できるようにします。</li><li>ビジネス ユニットや秘密度のレベルなどの属性を持つエンタープライズ アプリケーションを分類してレポートする必要があります。たとえば、アプリケーションを所有するビジネス ユニットごとに、各エンタープライズ アプリケーションを追跡します。</li><li>Azure ストレージ リソースに関して、API アクセス キーや SAS トークンから、一元化された一貫性のあるアクセス制御 (Azure RBAC + ABAC) に移行することで、セキュリティ態勢を改善する必要があります。API アクセス キーや SAS トークンは、ID に紐づけられていないないため、アクセス キーやトークンを持っている人は誰でもリソースにアクセスすることができます。 スケーラブルにセキュリティ対策を強化するためには、数百万の Azure Storage Blob へのアクセスを少ないロール割り当てで管理できるよう、リソース属性とともにユーザー属性が必要です。</li></ul><p>ここでは、どのように属性を管理し、Azure ADオブジェクトをフィルタリングすればよいか、Azure でアクセス制御を拡張する方法を簡単に見てみましょう。</p><h2 id="ステップ-1-Azure-AD-での属性の定義"><a href="#ステップ-1-Azure-AD-での属性の定義" class="headerlink" title="ステップ 1: Azure AD での属性の定義"></a>ステップ 1: Azure AD での属性の定義</h2><p>最初のステップは、関連する属性の集まりである “属性セット” を作成することです。たとえば、マーケティング部門に関連する属性を参照したい場合は、「marketing」という名前の属性セットを作成することができます。次に、属性セット内の属性と、属性セットの特徴を定義します。たとえば、属性にはあらかじめ定義された値しか使用できないことや、属性に割り当てられる値は 1 つか、もしくは複数かなどを指定します。この例では、プロジェクト属性に3つの値 (Cascade、Baker、Skagit) があり、ユーザーには 3 つの値のうち 1 つしか割り当てられません。下の図は、上記の例を示しています。</p><p><img src="/blog/azure-active-directory/introducing-azuread-custom-security-attributes/1_addattribute.png"></p><h2 id="ステップ-2-ユーザーまたはエンタープライズ-アプリケーションへの属性の割り当て"><a href="#ステップ-2-ユーザーまたはエンタープライズ-アプリケーションへの属性の割り当て" class="headerlink" title="ステップ 2: ユーザーまたはエンタープライズ アプリケーションへの属性の割り当て"></a>ステップ 2: ユーザーまたはエンタープライズ アプリケーションへの属性の割り当て</h2><p>属性が定義されると、ユーザー、エンタープライズ アプリケーション、およびマネージド ID に割り当てることができます。</p><p><img src="/blog/azure-active-directory/introducing-azuread-custom-security-attributes/2_assignment.png"></p><p>属性を割り当てると、属性を使ってユーザーやアプリケーションをフィルタリングできます。たとえば、秘密度レベルが「高」のすべてのエンタープライズ アプリケーションを確認することができます。</p><p><img src="/blog/azure-active-directory/introducing-azuread-custom-security-attributes/3_filtering.png"></p><h2 id="ステップ-3-属性管理の委任"><a href="#ステップ-3-属性管理の委任" class="headerlink" title="ステップ 3: 属性管理の委任"></a>ステップ 3: 属性管理の委任</h2><p>属性を管理するために利用できる Azure AD の組み込みロールは 4 つあります。</p><table><thead><tr><th>アクセス許可</th><th>グローバル管理者</th><th>属性定義管理者</th><th>属性割り当て管理者</th><th>属性定義閲覧者</th><th>属性割り当て閲覧者</th></tr></thead><tbody><tr><td>属性セットを読み取る</td><td></td><td>〇</td><td>〇</td><td>〇</td><td>〇</td></tr><tr><td>属性の定義を読み取る</td><td></td><td>〇</td><td>〇</td><td>〇</td><td></td></tr><tr><td>ユーザーやアプリ (サービス プリンシパル) の属性割り当てを読み取る</td><td></td><td></td><td>〇</td><td></td><td>〇</td></tr><tr><td>属性セットを追加もしくは編集する</td><td></td><td>〇</td><td></td><td></td><td></td></tr><tr><td>属性の定義を追加、編集もしくは非アクティブ化する</td><td></td><td>〇</td><td></td><td></td><td></td></tr><tr><td>ユーザーやアプリ (サービス プリンシパル) へ属性を割り当てる</td><td></td><td></td><td>〇</td><td></td><td></td></tr></tbody></table><p>既定ではグローバル管理者とグローバル閲覧者は、属性を作成、読み取り、または更新することができません。グローバル管理者または特権ロール管理者は、属性を管理するために、属性管理ロールを他のユーザーまたは自身に割り当てる必要があります。これら 4 つのロールは、テナントまたは属性セットのスコープで割り当てることができます。テナント スコープで役割を割り当てると、すべての属性セットの管理を委任することができます。属性セットのスコープで役割を割り当てると、特定の属性セットの管理を委任することができます。例を挙げて説明します。</p><p><img src="/blog/azure-active-directory/introducing-azuread-custom-security-attributes/4_xia.png"></p><ol><li>Xia は特権ロール管理者です。そのため、Xia はテナント レベルで属性定義管理者ロールを自身に割り当てます。これにより、彼女は属性セットを作成することができます。</li><li>エンジニアリング部門では、Alice が属性の定義を担当し、Chandra が属性の割り当てを担当しています。Xia はエンジニアリング属性セットを作成し、Alice には属性定義管理者ロールを、Chandra にはエンジニアリング属性セット スコープの属性割り当て管理者ロールを割り当て、Alice と Chandra が必要最小限の権限を持つようにします。</li><li>マーケティング部門では、Bob が属性の定義と割り当てを担当しています。Xia は、マーケティング属性セットを作成し、属性定義管理者と属性割り当て管理者のロールを Bob に割り当てます。</li></ol><h2 id="ステップ-4-少ない-Azure-ロール割り当てできめ細かなアクセス制御を実現する"><a href="#ステップ-4-少ない-Azure-ロール割り当てできめ細かなアクセス制御を実現する" class="headerlink" title="ステップ 4: 少ない Azure ロール割り当てできめ細かなアクセス制御を実現する"></a>ステップ 4: 少ない Azure ロール割り当てできめ細かなアクセス制御を実現する</h2><p>前回のブログ記事 <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/introducing-attribute-based-access-control-abac-in-azure/ba-p/2147069">Azure ロール割り当てでの ABAC 条件</a> で紹介した架空の例をもとに考えてみましょう。 Bob は、照明や家電など何千ものカテゴリの商品を販売するホームセンター チェーンである Contoso 株式会社営業チームの Azure サブスクリプション所有者です。これらのカテゴリの日次売上レポートは、その日 (たとえば 2021-03-24) の Azure ストレージ コンテナに保存されており、中央の財務チームのメンバーは、より簡単にレポートにアクセスできます。Charlie は照明カテゴリのセールス マネージャーで、照明カテゴリの売上レポートをどのストレージコンテナでも読めるようにする必要がありますが、他のカテゴリーのレポートを読むことはできません。</p><p>リソース属性（例えば、blob インデックス タグ）だけでは、Bob は Charlie のロール割り当てを 1 つ作成し、blob インデックス タグが「category = lighting」となっている blob への読み取りアクセスを制限する条件を追加する必要があります。Bob は Charlie のようなユーザーの数だけ、多くのロール割り当てを作成する必要があります。リソース属性と併用してユーザー属性を使用すると、Bob は Azure AD グループ内のすべてのユーザーを対象とした 1 つのロール割り当てを作成し、”ユーザーの category 属性値が blob の category タグ値と一致する” ように要求する ABAC 条件を追加することができます。Azure AD 管理者の Xia は、「contosocentralfinance」という属性セットを作成し、Bob に属性セットの Azure AD 属性定義管理者と属性割り当て管理者のロールを割り当て、Bob が自分の仕事をするのに最低限必要な権限を与えます。以下の図は、このシナリオを示しています。</p><p><img src="/blog/azure-active-directory/introducing-azuread-custom-security-attributes/5_abac.png"></p><p>Bob は、ユーザー属性とリソース属性を使って、ABAC 条件ビルダーで次のような条件を書きます。</p><p><img src="/blog/azure-active-directory/introducing-azuread-custom-security-attributes/6_roleassignmentcondition.png"></p><p>まとめると、ユーザー属性、リソース属性、ABAC 条件を使えば、わずか 1 つのロール割り当てで、何百万もの Azure ストレージ Blob へのアクセスを管理することができるのです。  </p><h2 id="監査とツール"><a href="#監査とツール" class="headerlink" title="監査とツール"></a>監査とツール</h2><p>属性には機密情報が含まれ、アクセスを許可または拒否することができるため、属性の定義、割り当て、および割り当て解除に関するアクティビティは Azure AD 監査ログに記録されます。属性に関連するタスクの管理と自動化には、ポータルに加えて、PowerShell や Microsoft Graph API を使用できます。Azure CLI、PowerShell、または Azure Resource Manager テンプレートと Azure REST API を使用して、Azure ロール割り当ての ABAC 条件を管理することもできます。</p><h2 id="リソース"><a href="#リソース" class="headerlink" title="リソース"></a>リソース</h2><p>始めやすいように、条件のサンプルを含むいくつかの <a href="https://docs.microsoft.com/ja-jp/azure/storage/common/storage-auth-abac-examples?toc=/azure/role-based-access-control/toc.json">例</a> を用意しています。Contoso 株式会社の <a href="https://docs.microsoft.com/ja-jp/azure/role-based-access-control/conditions-custom-security-attributes-example">例</a> では、ABAC 条件を使用して Azure ストレージ Blob に関するシナリオのアクセス制御をどのように拡張できるかを案内しています。また、Azure AD のドキュメント、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/custom-security-attributes-manage">How-to</a>、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/custom-security-attributes-troubleshoot">トラブルシューティング</a> のガイドも利用できます。</p><p>Azure AD の <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/custom-security-attributes-overview">カスタム セキュリティ属性</a> と <a href="https://docs.microsoft.com/ja-jp/azure/role-based-access-control/conditions-overview">Azure ストレージの ABAC 条件</a> について、皆様のご意見をお待ちしています。今後、Azure AD の条件付きアクセスでカスタム セキュリティ属性を使用する方法についても紹介するのでぜひ楽しみにしておいてください。皆様からのご意見、<a href="https://forms.office.com/pages/responsepage.aspx?id=v4j5cvGGr0GRqy180BHbR-lT4fPHJUBHjqPLpZfcitlUQkVNUTg1UjFaUldJQlMyOUVVNDBGTlBRTi4u">今後のシナリオ</a> のアイデアをお待ちしています。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 12 月 1 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommunity.micr</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>ゼロ トラスト展開のためのよりよいコントロールとインサイト</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/more-control-and-better-insights-for-your-zero-trust-deployments/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/more-control-and-better-insights-for-your-zero-trust-deployments/</id>
    <published>2021-12-18T00:00:00.000Z</published>
    <updated>2022-03-05T11:48:29.489Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>本記事は、 2021 年 11 月 30 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/more-control-and-better-insights-for-your-zero-trust-deployments/ba-p/2365684">More control and better insights for your Zero Trust deployments</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>Ignite 2021 はお楽しみいただけましたか？ユーザーやアプリケーションを脅威から保護するため、ゼロ トラストを展開するうえでどのように Azure Active Directory を使っているか、皆様からのご意見を伺うことができました。多くの方から、ID 環境の保護と調査のために、より強力で使いやすいツールを求める声をいただいています。そこで本日は、Azure AD の条件付きアクセスと Identity Protection の新機能について詳しくご紹介します。新しい機能を使うと、ID の保護を強化するとともに、業務をより簡単に進めることができるようになります。</p><h2 id="Azure-AD-の条件付きアクセスと-Identity-Protection-の新機能"><a href="#Azure-AD-の条件付きアクセスと-Identity-Protection-の新機能" class="headerlink" title="Azure AD の条件付きアクセスと Identity Protection の新機能"></a>Azure AD の条件付きアクセスと Identity Protection の新機能</h2><p>Ignite では、複数の強力な機能を発表しました。より使いやすくなった条件付きアクセスに加え、ゼロ トラストの展開を加速させるインサイトの提供、さらに主要なシナリオについてより包括的な保護を行えるようになりました。<strong>条件付きアクセスの概要を示すダッシュボード</strong> (パブリック プレビュー版) では、ポリシーの適用範囲におけるギャップを素早く見つけることができ、テンプレートを使用することで推奨されるポリシーをより簡単に導入することができます。また、デバイス用のフィルターやアプリ用のフィルター (一般公開 / GA) では、特権操作を行うワークステーションへ管理者のみがアクセスできるよう制限するなど新たなシナリオが追加され、主要なシナリオをより包括的にカバーできるようになりました。最後に、<strong>リスク データのエクスポート</strong> (新しいトークン シグナルを含む) がより簡単になり、素晴らしいワークブックも追加されたので、お客様側でリスクについての詳細 (およびその対処法) を得ることもできるようになりました。</p><h3 id="条件付きアクセスの概要ダッシュボード"><a href="#条件付きアクセスの概要ダッシュボード" class="headerlink" title="条件付きアクセスの概要ダッシュボード"></a>条件付きアクセスの概要ダッシュボード</h3><p>まず、<strong>条件付きアクセスの概要ダッシュボード</strong> を見てみましょう。ポリシーの数が増えてくると、管理者はそのポリシーが本当に組織全体を保護しているかどうか把握する必要があります。条件付きアクセスの新しい概要ダッシュボードでは、ポリシーの適用範囲内にあるユーザ、アプリ、デバイスをまとめ、ポリシーの適用範囲にあるギャップを明らかにすることで、包括的なポリシーの展開がこれまで以上に容易になります。</p><p><img src="/blog/azure-active-directory/more-control-and-better-insights-for-your-zero-trust-deployments/1_CAdashboard.png"></p><p>ダッシュボードは 4 つのメインタブで構成されています。</p><ul><li>はじめに: 条件付きアクセスを初めて利用する方は、ポリシーを構成する要素について学んで新しいポリシーを作成ください。  </li><li>概要: 条件付きアクセスで保護されているユーザー、デバイス、アプリケーションの概要を確認できます。また、テナント内のサインイン アクティビティ データに基づいて推奨されるポリシーを表示したり、ポリシー テンプレートからすばやくポリシーを展開したりすることができます。  </li><li>カバレッジ:  テナント内で最も頻繁にアクセスされるアプリケーションが、条件付きアクセスによって保護されていることを確認できます。  </li><li>監視: テナント内の各ポリシーの影響を視覚化し、フィルターを追加してゲスト アクセスやレガシー認証、危険なサインイン、管理外のデバイスなどの傾向を確認できます。 </li><li>チュートリアル: 一般的に導入されている条件付きアクセス ポリシーとそのベスト プラクティスについて学べます。  </li></ul><h3 id="条件付きアクセス-テンプレート"><a href="#条件付きアクセス-テンプレート" class="headerlink" title="条件付きアクセス テンプレート"></a>条件付きアクセス テンプレート</h3><p>さらに、マイクロソフトが推奨するベスト プラクティスに沿った新しいポリシーを展開する際、簡単にサンプルとして利用できる方法を提供し、進化する脅威への対応を支援するため、<strong>条件付きアクセス テンプレート</strong> を発表しました。これらのテンプレートは、ユーザーやデバイスを最大限に保護し、さまざまなユーザーの種類や場所で共通して使用可能なポリシーを作成するのに役立ちます。</p><p>14 種類の組み込みテンプレートから、新しいポリシーをすばやく作成できます (今後、お客様のご意見や新しい機能、新しい攻撃タイプへの対応に基づいてテンプレートを追加していきます)。テンプレートからポリシーを展開するのは簡単です。テンプレートを使用するだけでもよいかもしれませんが、テンプレートから始めて、ビジネス ニーズに合わせてカスタマイズしていくこともできます。  </p><p><img src="/blog/azure-active-directory/more-control-and-better-insights-for-your-zero-trust-deployments/2_CAtemplate.png" alt="図 1: 条件付きアクセス テンプレートの管理画面"></p><h3 id="デバイス用の条件付きアクセス-フィルター"><a href="#デバイス用の条件付きアクセス-フィルター" class="headerlink" title="デバイス用の条件付きアクセス フィルター"></a>デバイス用の条件付きアクセス フィルター</h3><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-condition-filters-for-devices">デバイス用のフィルター</a> を使用すると、デバイスの属性にもとづいて、一連のデバイスに条件付きアクセス ポリシーを適用できます。この機能により、重要なリソースへのアクセスに特権アクセスのワークステーションを必要とするなど、お客様が求めていた多くの新しいシナリオが実現します。また、デバイス フィルター条件を使用して、IoT デバイス (Teams ミーティング ルームを含む) の使用を保護することも可能です。Surface Hubs、Teams 電話、Teams 会議室をはじめ、あらゆる IoT デバイスに対応しています。Azure AD の動的グループや、Microsoft Endpoint Manager ですでに提供されているものと同じようにルール作成ができるよう、デバイス用のフィルターを設計しました。  </p><p>デバイス ID、表示名、モデル、モバイル デバイス管理 (MDM) のアプリ ID など、組み込みで用意されているデバイスのプロパティに加えて、最大 15 個の <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-condition-filters-for-devices">追加拡張属性</a> をサポートしています。ルール ビルダーを使えば、ブール論理を使ったデバイスのマッチング ルールを簡単に構築することができます。また、ルールの構文を直接編集して、より高度なマッチング ルールを実現することもできます。この新しい条件を用いることで、お客様の環境にてどのようなシナリオを実現できるのかとても楽しみです。</p><p><img src="/blog/azure-active-directory/more-control-and-better-insights-for-your-zero-trust-deployments/3_devicefilter.png" alt="図 2: デバイス用フィルターの管理画面"></p><h3 id="アプリケーション用フィルター"><a href="#アプリケーション用フィルター" class="headerlink" title="アプリケーション用フィルター"></a>アプリケーション用フィルター</h3><p>条件付きアクセスでは、デバイス用のフィルターに加えて、アプリケーション用のフィルターも使用できます。テナント上のアプリの数が爆発的に増えているため、大規模環境でアプリにポリシーを適用するための簡単な方法が必要だとの声をいただいています。アプリ用のフィルターを使用すると、カスタム セキュリティ属性にもとづいて、条件付きアクセスの対象アプリをより簡単に指定できます。一連のアプリにカスタム セキュリティ属性のタグを付けるだけで、すべてのアプリを個別に選択するのではなく、その属性を持つアプリに直接ポリシーを適用することができます。新しいアプリが導入された場合も、ポリシーを更新するのではなく、アプリに属性を追加するだけで済みます。</p><p>アプリ用のフィルターは、新しい Azure AD カスタム セキュリティ属性を使用します。カスタム セキュリティ属性は、組織ごとに作成および管理されるため、自社に適した属性を定義して、条件付きアクセスポリシーで使用することができます。また、カスタム セキュリティ属性は、豊富な委任モデルをサポートしています。アプリに特定の属性を追加できるユーザーを選択したり、アプリの所有者がこれらの属性を変更できないようにしたりすることも可能です。これにより、管理者がポリシーを変更したり、誤って変更したりすることなく、一連の管理者がアプリに条件付きアクセス ポリシーを簡単に導入し管理できるようになります。アプリ用の条件付きアクセス フィルターは、近日中にパブリック プレビュー版が公開される予定です。  </p><p><img src="/blog/azure-active-directory/more-control-and-better-insights-for-your-zero-trust-deployments/4_appfilter.png" alt="図 3: アプリ フィルター"></p><h3 id="診断設定での新しいエクスポート-オプション"><a href="#診断設定での新しいエクスポート-オプション" class="headerlink" title="診断設定での新しいエクスポート オプション"></a>診断設定での新しいエクスポート オプション</h3><p>Identity Protecion の豊富な検知機能とシグナルを元に、2 つの大きな改善を行い、リスク データを活用してお客様の環境の傾向を簡単に把握できるようにしました。</p><p>1 つ目の改善点は、<strong>診断設定</strong> の拡張です。リスク データをエクスポートするための新しい方法を追加しました。ワンクリックでリスクのあるユーザーやリスクの検出データを Log Analytics やサードパーティの SIEM に送信することができます。また、既定の保存期間を超えてデータを保持する必要がある場合には、数ヶ月分のデータをワンクリックでストレージ アカウントに送信できるようになりました。  </p><p><img src="/blog/azure-active-directory/more-control-and-better-insights-for-your-zero-trust-deployments/5_setting.png" alt="図 4: Identity Protection 診断設定の管理画面"></p><h3 id="リスク分析ワークブック"><a href="#リスク分析ワークブック" class="headerlink" title="リスク分析ワークブック"></a>リスク分析ワークブック</h3><p>また、組織内のリスクの傾向についてより深いインサイトを、簡単な設定で得たいというご要望もいただきました。そこで、Log Analytics と拡張された診断設定をベースに、Identity Protection のための新しい「リスク分析ワークブック」をリリースしました。このワークブックには、最も多く発生しているリスクの種類と、それらが発生している場所が示されています。さらに、お客様の環境で検出されたリスクにどれだけ効果的に対応しているかを可視化し、ポリシー設定を改善できるよう着目点を示すように支援します。  </p><p><img src="/blog/azure-active-directory/more-control-and-better-insights-for-your-zero-trust-deployments/6_heatmap.png" alt="図 5: ヒート マップ"></p><p>新しいワークブックを使用するには</p><ol><li>Azure ポータルにサインインします。  </li><li>[Azure Active Directory」→ [監視] タブ →「Workbooks」に移動します。  </li><li>[Identity Protection リスク分析] をクリックします。</li></ol><p>条件付きアクセスのこれらの新機能により、ゼロ トラストの導入がさらに容易になり、お客様にとって新しいシナリオが利用可能となれば幸いです。また、2 つの Identity Protection の機能は、シンプルでありながら強力なインサイトを備えており、お客様の環境をより把握するのに活用いただけると考えています。皆様からのフィードバックをお待ちしております。Microsoft Tech Community での会話に参加して、ご意見やご提案をお聞かせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2021 年 11 月 30 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
</feed>
